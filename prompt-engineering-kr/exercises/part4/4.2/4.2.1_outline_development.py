"""
학술 에세이/보고서 개요 작성 실습 모듈

Part 4 - 섹션 4.2.1 실습 코드: 효과적인 학술 에세이와 보고서 개요 작성 전략과 AI 활용법을 학습합니다.
"""

import os
import sys
from typing import Dict, List, Any, Optional

# 상위 디렉토리를 경로에 추가하여 utils 모듈을 import할 수 있게 설정
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_dir)))
sys.path.append(project_root)

from utils.prompt_builder import PromptBuilder
from utils.exercise_template import run_exercise

# 주제 옵션 정의 - 파일명 문제를 방지하기 위해 특수문자 제거
OUTLINE_TOPICS = {
    "1": {"name": "개요 구조 설계", "topic": "효과적인 학술 에세이 및 보고서 개요의 구조와 형식", "output_format": "가이드"},
    "2": {"name": "주제 분석과 범위", "topic": "주제 분석과 범위 설정을 통한 개요 준비", "output_format": "분석 프레임워크"},
    "3": {"name": "AI 활용 개요 개발", "topic": "AI를 활용한 학술 개요 브레인스토밍과 발전", "output_format": "프롬프트 전략"},
    "4": {"name": "개요 테스트와 검증", "topic": "개요의 완전성, 논리성, 균형성 검증 방법", "output_format": "체크리스트"},
    "5": {"name": "개요에서 초안으로", "topic": "개요에서 초안으로의 효과적인 전환 전략", "output_format": "단계별 가이드"}
}

# 프롬프트 요약 정보
PROMPT_SUMMARY = {
    "basic": ["주제에 대한 직접적인 질문"],
    "enhanced": [
        "전문가 역할 설정: 학술 글쓰기 및 개요 작성 전문가 역할 부여",
        "맥락 설정: 학술 에세이/보고서 개요 작성의 구체적 상황 제시",
        "세부 요청: 개요 작성의 원칙, 구조, 전략에 대한 구체적 지침 요청",
        "형식 지정: 실용적인 예시와 도구를 포함한 구조화된 가이드 요청"
    ]
}

# 학습 포인트
LEARNING_POINTS = [
    "효과적인 학술 에세이/보고서 개요의 핵심 요소와 구조를 이해할 수 있습니다",
    "목적과 독자에 맞는 개요 작성 전략을 습득할 수 있습니다",
    "AI를 활용하여 체계적인 개요를 개발하고 개선하는 방법을 배울 수 있습니다",
    "논리적 흐름과 일관성 있는 에세이/보고서 구조를 설계할 수 있습니다",
    "개요에서 최종 문서로 효과적으로 전환하는 기법을 익힐 수 있습니다"
]

def get_basic_prompt(topic: str) -> str:
    """기본 프롬프트 생성"""
    return f"{topic}에 대해 알려주세요."

def get_enhanced_prompt(topic: str, purpose: str, output_format: str) -> str:
    """향상된 프롬프트 생성"""
    builder = PromptBuilder()
    
    # 주제별 역할 및 맥락 설정
    if "개요 구조 설계" in topic:
        builder.add_role(
            "학술 개요 설계 전문가", 
            "저명한 대학의 학술 글쓰기 센터 디렉터로, 수천 명의 학생과 연구자들에게 효과적인 학술 개요 작성법을 가르쳐온 전문가"
        )
        
        builder.add_context(
            f"저는 대학원생으로 학술 논문을 준비 중이며, {topic}에 대한 체계적인 지침이 필요합니다. "
            f"다양한 개요 유형(대략적/상세, 알파벳-숫자식/십진법식, 문장형/키워드형 등)과 그 효과적인 활용법, "
            f"학술 논문 유형별 최적의 개요 구조에 대한 실용적인 가이드가 필요합니다."
        )
        
        builder.add_instructions([
            "다양한 개요 유형(세부 수준, 구조화 방식 등)의 특징과 적합한 상황을 비교 설명해주세요",
            "학술 에세이/보고서의 일반적인 섹션 구조와 각 섹션에 포함될 내용을 상세히 안내해주세요",
            "논문 유형별(설명형, 분석형, 논증형, 비교형 등) 최적의 개요 구조를 예시와 함께 제안해주세요",
            "효과적인 개요 작성을 위한 실용적인 템플릿과 형식을 제공해주세요",
            "개요 구조 설계 시 흔히 범하는 실수와 이를 피하는 방법도 설명해주세요"
        ])
        
    elif "주제 분석과 범위" in topic:
        builder.add_role(
            "학술 주제 분석 전문가", 
            "연구 방법론 교수이자 학위 논문 지도 전문가로, 복잡한 학술 주제를 체계적으로 분석하고 효과적인 연구 범위를 설정하는 데 전문성을 가진 학자"
        )
        
        builder.add_context(
            f"저는 학부 고학년 학생으로 첫 학술 논문을 작성 중이며, {topic}에 어려움을 겪고 있습니다. "
            f"광범위한 주제를 어떻게 분석하고 관리 가능한 범위로 좁히는지, 효과적인 연구 질문을 개발하는 방법, "
            f"그리고 이를 체계적인 개요로 발전시키는 프로세스에 대한 안내가 필요합니다."
        )
        
        builder.add_instructions([
            "학술 주제 분석의 핵심 단계와 효과적인 방법론을 구체적으로 설명해주세요",
            "연구 범위를 적절히 설정하는 전략과 고려사항(시간적, 공간적, 개념적 경계 등)을 안내해주세요",
            "효과적인 연구 질문/논제 개발을 위한 단계별 접근법과 평가 기준을 제시해주세요",
            "주제 분석에서 개요 작성으로 연결되는 체계적인 프로세스를 설명해주세요",
            "다양한 학문 분야(인문학, 사회과학, 자연과학 등)에 맞춘 주제 분석 프레임워크도 제공해주세요"
        ])
        
    elif "AI 활용 개요 개발" in topic:
        builder.add_role(
            "AI 활용 학술 글쓰기 전문가", 
            "AI와 학술 글쓰기의 통합에 관한 연구자이자 컨설턴트로, 학생들과 연구자들에게 AI를 활용한 효과적인 학술 개요 개발 방법을 가르치는 전문가"
        )
        
        builder.add_context(
            f"저는 대학원생으로 AI 도구를 활용해 학술 논문 개요를 개발하고자 하며, {topic}에 관심이 있습니다. "
            f"AI를 활용한 효과적인 브레인스토밍, 구조화, 개요 발전 및 개선을 위한 최적의 프롬프트 전략과 "
            f"워크플로우가 필요합니다. 학문적 진정성을 유지하면서 AI의 강점을 활용하는 방법을 배우고 싶습니다."
        )
        
        builder.add_instructions([
            "AI를 활용한 학술 개요 개발의 다양한 단계(초기 구조화, 브레인스토밍, 발전, 검토)를 설명해주세요",
            "각 단계에 최적화된 효과적인 프롬프트 전략과 구체적인 프롬프트 예시를 제공해주세요",
            "AI 생성 콘텐츠를 비판적으로 평가하고 자신의 학술적 목소리와 통합하는 방법을 안내해주세요",
            "AI 활용 시 발생할 수 있는 함정이나 한계를 피하는 전략도 제시해주세요",
            "실제 학술 주제를 사용한 AI 활용 개요 개발의 전체 워크플로우 예시를 단계별로 보여주세요"
        ])
        
    elif "개요 테스트와 검증" in topic:
        builder.add_role(
            "학술 개요 평가 전문가", 
            "유명 학술지 편집위원이자 대학 글쓰기 센터 컨설턴트로, 학술 개요의 품질, 완전성, 논리성을 평가하고 개선하는 데 전문성을 가진 전문가"
        )
        
        builder.add_context(
            f"저는 중요한 학술 논문을 준비 중인 연구자로, {topic}에 대한 체계적인 접근법이 필요합니다. "
            f"작성한 개요가 논리적 일관성, 균형성, 완전성을 갖추었는지 객관적으로 평가하고, "
            f"잠재적 문제점을 미리 발견하여 개선하는 방법에 대한 구체적인 체크리스트와 전략이 필요합니다."
        )
        
        builder.add_instructions([
            "학술 개요의 품질을 평가하는 핵심 기준(완전성, 논리성, 균형성, 일관성 등)을 상세히 설명해주세요",
            "개요의 구조적, 내용적, 논리적 측면을 체계적으로 검증하는 포괄적인 체크리스트를 제공해주세요",
            "다양한 관점(지도교수, 동료, 독자)에서 개요를 평가하는 전략과 질문 세트를 제안해주세요",
            "발견된 문제점을 효과적으로 해결하기 위한 개선 전략과 단계별 접근법을 설명해주세요",
            "학문 분야별 특수한 검증 기준이나 고려사항도 포함해주세요"
        ])
        
    else:  # 개요에서 초안으로
        builder.add_role(
            "학술 글쓰기 전환 전문가", 
            "베스트셀러 학술 글쓰기 안내서 저자이자 글쓰기 워크숍 진행자로, 학생과 연구자들이 개요에서 초안으로 효과적으로 전환하는 전략을 가르치는 전문가"
        )
        
        builder.add_context(
            f"저는 학위 논문을 준비 중인 대학원생으로, {topic}에 어려움을 겪고 있습니다. "
            f"상세한 개요를 작성했지만 이를 응집력 있는 초안으로 발전시키는 과정에서 막히곤 합니다. "
            f"개요의 각 항목을 어떻게 확장하고, 논점 간 자연스러운 전환을 만들며, "
            f"전체적인 흐름과 일관성을 유지하는 효과적인 전략이 필요합니다."
        )
        
        builder.add_instructions([
            "개요에서 초안으로 전환하는 주요 접근법(섹션별, 비선형, 확장, 전환 중심 등)과 각각의 장단점을 설명해주세요",
            "개요의 각 항목을 완전한 단락으로 효과적으로 확장하는 단계별 프로세스를 구체적인 예시와 함께 안내해주세요",
            "섹션과 단락 간 자연스러운 전환을 구축하는 다양한 전략과 전환구 예시를 제공해주세요",
            "초안 작성 과정에서 개요의 논리적 구조와 흐름을 유지하는 방법을 설명해주세요",
            "AI 도구를 활용하여 개요에서 초안으로의 전환을 지원하는 효과적인 프롬프트와 전략도 포함해주세요"
        ])
    
    # 출력 형식 지정
    builder.add_format_instructions(
        f"응답은 {output_format} 형식으로 구성해주세요. "
        f"마크다운 형식을 사용하여 제목, 소제목, 목록 등을 명확히 구분해주세요. "
        f"이론적 설명과 실용적인 적용 전략을 균형 있게 포함해주세요. "
        f"다양한 학문 분야에 적용할 수 있는 구체적인 예시와 템플릿을 제공해주세요. "
        f"가능한 경우 표, 다이어그램, 체크리스트 등 시각적 요소를 활용하여 이해를 돕고 즉시 활용 가능한 도구를 제공해주세요. "
        f"초보자부터 경험 있는 연구자까지 다양한 수준의 사용자가 이해하고 적용할 수 있도록 명확하고 단계적인 안내를 제공해주세요."
    )
    
    return builder.build()

def main():
    """메인 함수"""
    # 실행 결과를 저장할 때 챕터별 폴더 구조를 사용
    run_exercise(
        title="학술 에세이 및 보고서 개요 작성",  # 제목에서 슬래시 제거
        topic_options=OUTLINE_TOPICS,
        get_basic_prompt=get_basic_prompt,
        get_enhanced_prompt=get_enhanced_prompt,
        prompt_summary=PROMPT_SUMMARY,
        learning_points=LEARNING_POINTS
    )

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n프로그램이 사용자에 의해 중단되었습니다.")
    except Exception as err:
        print(f"\n오류 발생: {err}")
        print("API 키나 네트워크 연결을 확인하세요.")