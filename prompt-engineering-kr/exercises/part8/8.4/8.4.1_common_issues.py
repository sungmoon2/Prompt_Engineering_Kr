"""
비효과적 프롬프트 분석 실습 모듈

Part 8 - 섹션 8.4.1 실습 코드: 비효과적인 프롬프트의 문제점을 체계적으로 분석하고 개선하는 방법을 학습합니다.
"""

import os
import sys
from typing import Dict, List, Any, Optional

# 상위 디렉토리를 경로에 추가하여 utils 모듈을 import할 수 있게 설정
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_dir)))
sys.path.append(project_root)

from utils.prompt_builder import PromptBuilder
from utils.exercise_template import run_exercise

# 주제 옵션 정의
PROMPT_ANALYSIS_TOPICS = {
    "1": {"name": "학술 연구 프롬프트", "topic": "학술 연구 관련 비효과적 프롬프트 분석", "output_format": "분석 보고서"},
    "2": {"name": "비즈니스 분석 프롬프트", "topic": "비즈니스 분석 관련 비효과적 프롬프트 분석", "output_format": "개선 가이드"},
    "3": {"name": "창의적 글쓰기 프롬프트", "topic": "창의적 글쓰기 관련 비효과적 프롬프트 분석", "output_format": "분석 및 개선 예시"},
    "4": {"name": "코딩 및 개발 프롬프트", "topic": "코딩 및 개발 관련 비효과적 프롬프트 분석", "output_format": "문제 해결 매트릭스"},
    "5": {"name": "교육용 프롬프트", "topic": "교육 콘텐츠 개발 관련 비효과적 프롬프트 분석", "output_format": "진단 프레임워크"}
}

# 프롬프트 요약 정보
PROMPT_SUMMARY = {
    "basic": ["비효과적 프롬프트에 대한 일반적인 설명 요청"],
    "enhanced": [
        "역할 설정: 프롬프트 디버깅 전문가 역할 부여",
        "비교 분석: 효과적/비효과적 프롬프트 쌍에 대한 체계적 분석 요청",
        "프레임워크 적용: 구체적인 진단 프레임워크 적용 요청",
        "실용적 개선: 패턴별 개선 전략과 구체적인 예시 요청"
    ]
}

# 학습 포인트
LEARNING_POINTS = [
    "효과적인 프롬프트 디버깅은 목표와 실제 결과 간의 차이를 체계적으로 분석하는 것에서 시작합니다",
    "비효과적 프롬프트에는 모호성, 맥락 부족, 구조적 문제, 비현실적 기대 등 공통 패턴이 있습니다",
    "ABCD 프레임워크(모호성, 배경, 제약, 방향성)는 프롬프트 문제를 체계적으로 진단하는 데 유용합니다",
    "분야별로 특화된 프롬프트 개선 전략을 적용하면 더 효과적인 결과를 얻을 수 있습니다",
    "지속적인 프롬프트 분석과 개선은 AI와의 협업 품질을 크게 향상시킵니다"
]

def get_basic_prompt(topic: str) -> str:
    """기본 프롬프트 생성"""
    return f"{topic}에 대해 알려주세요."

def get_enhanced_prompt(topic: str, purpose: str, output_format: str) -> str:
    """향상된 프롬프트 생성"""
    builder = PromptBuilder()
    
    # 역할 및 맥락 설정
    builder.add_role(
        "프롬프트 디버깅 전문가", 
        "복잡한 프롬프트의 문제점을 체계적으로 분석하고 진단하여 효과적인 개선 방안을 제시하는 전문가"
    )
    
    # 맥락 정보 추가
    builder.add_context(
        f"저는 {topic}에 관심이 있는 프롬프트 엔지니어링 학습자입니다. "
        f"종종 AI에게 질문을 하거나 작업을 요청할 때 원하는 결과를 얻지 못하는 경우가 있습니다. "
        f"비효과적인 프롬프트의 공통적인 특징과 패턴을 이해하고, 체계적으로 분석하여 개선하는 방법을 배우고 싶습니다. "
        f"실제 사례를 통해 문제점을 식별하고 진단하는 프레임워크와 개선 전략을 배우고 싶습니다."
    )
    
    # 구체적인 지시사항 추가
    if "학술 연구" in topic:
        builder.add_instructions([
            "학술 연구 관련 비효과적 프롬프트의 일반적인 패턴과 문제점을 설명해주세요",
            "다음과 같은 비효과적 학술 연구 프롬프트 사례와 그 개선 버전을 비교 분석해주세요:\n"
            "비효과적: '인공지능이 교육에 미치는 영향에 대해 알려줘.'\n"
            "개선: '대학 교육 환경에서 인공지능 기술 활용이 학생들의 학습 성과와 참여도에 미치는 긍정적/부정적 영향을 분석해주세요. 특히 최근 5년간의 연구 동향을 중심으로, 주요 사례와 통계 데이터를 포함해 체계적으로 설명해주세요. 응답은 약 500단어 분량으로, 주요 장점, 한계점, 그리고 향후 발전 방향을 포함해 학술적 문헌 검토 형식으로 작성해주세요.'",
            "GAP 분석 프레임워크(Goal-Actual-Problem)를 적용하여 위 사례의 비효과적 프롬프트를 체계적으로 진단해주세요",
            "학술 연구 프롬프트에서 특히 주의해야 할 모호성, 맥락 부족, 구조적 문제, 기대치 불일치 등의 요소를 설명해주세요",
            "학술 연구 프롬프트를 효과적으로 개선하기 위한 분야 특화 전략과 체크리스트를 제안해주세요"
        ])
    elif "비즈니스 분석" in topic:
        builder.add_instructions([
            "비즈니스 분석 관련 비효과적 프롬프트의 일반적인 패턴과 문제점을 설명해주세요",
            "다음과 같은 비효과적 비즈니스 분석 프롬프트 사례와 그 개선 버전을 비교 분석해주세요:\n"
            "비효과적: '스타트업 성공 요인 분석해줘.'\n"
            "개선: '최근 5년간 한국의 핀테크 분야에서 시리즈 A 이상의 투자를 유치한 스타트업들의 주요 성공 요인을 분석해주세요. 분석에는 1) 창업팀 구성과 배경, 2) 비즈니스 모델 혁신성, 3) 시장 진입 전략, 4) 초기 고객 확보 방식, 5) 투자 유치 과정의 특징을 포함해주세요. 실제 사례를 2-3개 들어 설명하고, 각 요인의 상대적 중요도를 평가해주세요. 이 분석은 핀테크 분야 창업을 준비 중인 대학생 창업팀을 위한 참고 자료로 사용될 예정입니다. 1000단어 내외의 보고서 형식으로 작성해주세요.'",
            "ABCD 프레임워크(Ambiguity, Background, Constraints, Direction)를 적용하여 위 사례의 비효과적 프롬프트를 체계적으로 진단해주세요",
            "비즈니스 분석 프롬프트에서 특히 주의해야 할 명확성, 정량화, 맥락 설정, 목적 명시 등의 요소를 설명해주세요",
            "비즈니스 분석 프롬프트를 효과적으로 개선하기 위한 분야 특화 전략과 템플릿을 제안해주세요"
        ])
    elif "창의적 글쓰기" in topic:
        builder.add_instructions([
            "창의적 글쓰기 관련 비효과적 프롬프트의 일반적인 패턴과 문제점을 설명해주세요",
            "다음과 같은 비효과적 창의적 글쓰기 프롬프트 사례와 그 개선 버전을 비교 분석해주세요:\n"
            "비효과적: '흥미로운 단편 소설 써줘.'\n"
            "개선: '1980년대 한국의 작은 어촌 마을을 배경으로 한 청년의 성장 이야기를 다룬 3,000자 분량의 단편 소설을 작성해주세요. 주인공은 어부의 아들이지만 도시에서 교육을 받기 원하는 20대 초반의 청년으로, 전통과 현대 사이에서 갈등하는 모습을 그려주세요. 헤밍웨이 스타일의 간결한 문체를 사용하고, 바다와 자연을 상징적 요소로 활용해주세요. 인물의 내면 심리와 섬세한 묘사를 통해 한국적 정서가 잘 드러나도록 해주세요. 소설은 열린 결말로 마무리해주세요.'",
            "5W1H 진단 프레임워크(Who, What, When, Where, Why, How)를 적용하여 위 사례의 비효과적 프롬프트를 체계적으로 진단해주세요",
            "창의적 글쓰기 프롬프트에서 특히 주의해야 할 배경 설정, 인물 묘사, 플롯 구조, 문체 지정 등의 요소를 설명해주세요",
            "창의적 글쓰기 프롬프트를 효과적으로 개선하기 위한 분야 특화 전략과 예시를 제안해주세요"
        ])
    elif "코딩 및 개발" in topic:
        builder.add_instructions([
            "코딩 및 개발 관련 비효과적 프롬프트의 일반적인 패턴과 문제점을 설명해주세요",
            "다음과 같은 비효과적 코딩 및 개발 프롬프트 사례와 그 개선 버전을 비교 분석해주세요:\n"
            "비효과적: '이 코드 버그 고쳐줘.'\n"
            "개선: '다음 Python 코드는 사용자 입력 데이터를 처리하는 함수인데, 특정 조건에서 IndexError가 발생합니다. 문제는 빈 리스트가 입력될 때 발생하는 것으로 추정됩니다. 오류를 방지하고 빈 리스트나 None이 입력되도 안전하게 처리하도록 코드를 수정해주세요. 또한 함수의 가독성과 유지보수성을 높이기 위한 개선점도 제안해주세요. 수정된 코드와 함께 어떤 변경을 왜 했는지 설명도 부탁드립니다.\n```python\ndef process_data(data_list):\n    result = []\n    for i in range(len(data_list)):\n        value = data_list[i]\n        if value > 0:\n            result.append(value * 2)\n    return result\n```'",
            "GAP 분석 프레임워크(Goal-Actual-Problem)를 적용하여 위 사례의 비효과적 프롬프트를 체계적으로 진단해주세요",
            "코딩 및 개발 프롬프트에서 특히 주의해야 할 문제 명세, 기대 결과, 환경 정보, 오류 상황 재현 등의 요소를 설명해주세요",
            "코딩 및 개발 프롬프트를 효과적으로 개선하기 위한 분야 특화 전략과 템플릿을 제안해주세요"
        ])
    else:  # 교육용 프롬프트
        builder.add_instructions([
            "교육용 콘텐츠 개발 관련 비효과적 프롬프트의 일반적인 패턴과 문제점을 설명해주세요",
            "다음과 같은 비효과적 교육용 프롬프트 사례와 그 개선 버전을 비교 분석해주세요:\n"
            "비효과적: '중학생을 위한 과학 수업 자료 만들어줘.'\n"
            "개선: '중학교 2학년 학생들을 위한 태양계와 행성에 관한 45분 과학 수업 계획과 자료를 개발해주세요. 학생들은 이전에 기본적인 지구와 달의 관계에 대해서만 배웠으며, 이번 수업에서는 8개 행성의 특징과 태양계 내 위치적 특성을 학습해야 합니다. 수업 자료에는 1) 5분 분량의 도입 활동, 2) 20분 분량의 주요 개념 설명용 시각자료(각 행성별 주요 특징 포함), 3) 15분간 진행할 소그룹 활동 지침, 4) 5분 분량의 학습 확인용 형성평가 문항이 포함되어야 합니다. 학생들의 참여를 촉진하고 행성들의 크기, 구성, 특징을 쉽게 비교할 수 있는 시각적 비유나 활동도 제안해주세요. 자료는 한국 중학교 과학 교육과정에 부합해야 합니다.'",
            "ABCD 프레임워크(Ambiguity, Background, Constraints, Direction)를 적용하여 위 사례의 비효과적 프롬프트를 체계적으로 진단해주세요",
            "교육용 프롬프트에서 특히 주의해야 할 학습자 특성, 학습 목표, 교육 맥락, 평가 방식 등의 요소를 설명해주세요",
            "교육용 프롬프트를 효과적으로 개선하기 위한 분야 특화 전략과 템플릿을 제안해주세요"
        ])
    
    # 출력 형식 지정
    builder.add_format_instructions(
        f"응답은 {output_format} 형식으로 구성해주세요. "
        f"마크다운 형식을 사용하여 제목, 소제목, 목록 등을 명확히 구분해주세요. "
        f"다음 섹션들을 포함해주세요: "
        f"1) 비효과적 프롬프트 패턴 개요: 해당 분야의 비효과적 프롬프트 특징 "
        f"2) 사례 비교 분석: 제시된 비효과적/개선된 프롬프트 쌍의 상세 비교 "
        f"3) 진단 프레임워크 적용: 선택한 프레임워크로 문제점 체계적 분석 "
        f"4) 분야별 개선 전략: 해당 분야 특화된 프롬프트 개선 전략 "
        f"5) 실용적 템플릿/체크리스트: 재사용 가능한 프롬프트 개선 도구 "
        f"표, 다이어그램, 예시 등 시각적 요소를 활용하여 이해를 돕고, "
        f"이론적 설명과 실제 적용 사례를 균형 있게 포함해주세요."
    )
    
    return builder.build()

def main():
    """메인 함수"""
    # 실행 결과를 저장할 때 챕터별 폴더 구조를 사용
    run_exercise(
        title="실제 사례: 비효과적 프롬프트 분석",
        topic_options=PROMPT_ANALYSIS_TOPICS,
        get_basic_prompt=get_basic_prompt,
        get_enhanced_prompt=get_enhanced_prompt,
        prompt_summary=PROMPT_SUMMARY,
        learning_points=LEARNING_POINTS
    )

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n프로그램이 사용자에 의해 중단되었습니다.")
    except Exception as err:
        print(f"\n오류 발생: {err}")
        print("API 키나 네트워크 연결을 확인하세요.")