"""
재사용 가능한 템플릿 설계 실습 모듈

Part 7 - 섹션 7.3.3 실습 코드: 효율적이고 유연한 재사용 가능한 프롬프트 템플릿을 설계하고 활용하는 방법을 학습합니다.
"""

import os
import sys
from typing import Dict, List, Any, Optional

# 상위 디렉토리를 경로에 추가하여 utils 모듈을 import할 수 있게 설정
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_dir)))
sys.path.append(project_root)

from utils.prompt_builder import PromptBuilder
from utils.exercise_template import run_exercise

# 주제 옵션 정의
TEMPLATE_DESIGN_TOPICS = {
    "1": {"name": "분석 템플릿", "topic": "비판적 분석 및 평가를 위한 재사용 템플릿 설계", "output_format": "분석 템플릿 세트"},
    "2": {"name": "교육 템플릿", "topic": "개념 설명과 학습을 위한 재사용 템플릿 설계", "output_format": "교육 템플릿 세트"},
    "3": {"name": "창작 템플릿", "topic": "창의적 작업과 아이디어 생성을 위한 재사용 템플릿", "output_format": "창작 템플릿 세트"},
    "4": {"name": "의사결정 템플릿", "topic": "체계적인 선택과 문제 해결을 위한 재사용 템플릿", "output_format": "의사결정 템플릿 세트"},
    "5": {"name": "템플릿 시스템", "topic": "다양한 상황에 적응 가능한 유연한 템플릿 시스템 설계", "output_format": "템플릿 라이브러리"}
}

# 프롬프트 요약 정보
PROMPT_SUMMARY = {
    "basic": ["주제에 대한 일반적인 정보 요청"],
    "enhanced": [
        "변수 시스템: 맥락에 맞게 조정 가능한 변수 설계",
        "조건부 섹션: 상황별 포함/제외 가능한 모듈식 구조",
        "문서화: 템플릿 사용법과 최적 활용 지침 포함",
        "확장성: 다양한 상황에 적용 가능한 유연한 구조"
    ]
}

# 학습 포인트
LEARNING_POINTS = [
    "재사용 가능한 템플릿은 반복 작업의 효율성과 일관성을 크게 향상시킵니다",
    "변수와 조건부 섹션을 활용하면 하나의 템플릿으로 다양한 상황에 대응할 수 있습니다",
    "효과적인 템플릿은 구조적 일관성과 상황별 유연성 사이의 균형이 중요합니다",
    "체계적인 템플릿 라이브러리는 장기적으로 프롬프트 엔지니어링 역량을 강화합니다"
]

def get_basic_prompt(topic: str) -> str:
    """기본 프롬프트 생성"""
    return f"{topic}에 대해 설명해주세요."

def get_enhanced_prompt(topic: str, purpose: str, output_format: str) -> str:
    """향상된 프롬프트 생성"""
    builder = PromptBuilder()
    
    # 주제별 맞춤 역할 및 맥락 설정
    if "분석 템플릿" in topic:
        builder.add_role(
            "분석 프레임워크 설계자", 
            "다양한 주제와 대상을 체계적으로 분석하고 평가하기 위한 재사용 가능한 프롬프트 템플릿을 설계하는 전문가입니다."
        )
        
        builder.add_context(
            f"저는 {topic}에 관심이 있습니다. "
            f"문학 작품, 비즈니스 전략, 연구 논문, 제품 등 다양한 대상을 비판적으로 분석하고 평가하기 위한 재사용 가능한 템플릿을 개발하고 싶습니다. "
            f"특히 체계적인 분석 구조, 다양한 관점, 객관적 평가 기준을 포함하는 템플릿이 필요합니다."
        )
        
        builder.add_instructions([
            "비판적 분석을 위한 다양한 템플릿 구조(SWOT, 비교 분석, 다면 평가 등)와 각각의 적합한 사용 상황을 설명해주세요",
            "다양한 분석 대상(문학 작품, 비즈니스 사례, 연구 논문, 제품 등)에 맞게 조정 가능한 템플릿 설계 방법을 제시해주세요",
            "분석의 객관성과 다차원성을 보장하는 변수 시스템과 조건부 섹션 구현 방법을 설명해주세요",
            "구체적이고 재사용 가능한 분석 템플릿 세트(최소 3-5개)를 마크다운 형식으로 제공해주세요",
            "템플릿의 효과적인 활용과 상황별 맞춤화를 위한 실용적 지침을 제공해주세요"
        ])

    elif "교육 템플릿" in topic:
        builder.add_role(
            "교육 콘텐츠 설계자", 
            "복잡한 개념과 주제를 명확하게 설명하고 효과적인 학습을 촉진하는 재사용 가능한 프롬프트 템플릿을 설계하는 전문가입니다."
        )
        
        builder.add_context(
            f"저는 {topic}에 관심이 있습니다. "
            f"다양한 학문 분야와 기술을 효과적으로 설명하고 가르치기 위한 재사용 가능한 교육 템플릿을 개발하고 싶습니다. "
            f"특히 학습자의 배경 지식과 수준에 맞게 조정 가능하고, 단계적 이해를 촉진하는 구조화된 템플릿이 필요합니다."
        )
        
        builder.add_instructions([
            "효과적인 교육용 템플릿의 다양한 구조(개념 설명, 튜토리얼, 가이드 등)와 각각의 적합한 사용 상황을 설명해주세요",
            "다양한 학습 수준(초보자, 중급자, 전문가)과 학습 스타일에 맞게 조정 가능한 템플릿 설계 방법을 제시해주세요",
            "복잡한 개념을 단계적으로 소개하고 이해를 점진적으로 심화시키는 템플릿 구조를 설명해주세요",
            "구체적이고 재사용 가능한 교육 템플릿 세트(최소 3-5개)를 마크다운 형식으로 제공해주세요",
            "템플릿의 효과적인 활용과 학습 목표에 맞는 맞춤화를 위한 실용적 지침을 제공해주세요"
        ])
        
    elif "창작 템플릿" in topic:
        builder.add_role(
            "창의적 프로세스 설계자", 
            "창의적인 작업과 아이디어 발상을 체계적으로 지원하는 재사용 가능한 프롬프트 템플릿을 설계하는 전문가입니다."
        )
        
        builder.add_context(
            f"저는 {topic}에 관심이 있습니다. "
            f"스토리텔링, 콘텐츠 제작, 아이디어 발상, 문제 해결 등 다양한 창의적 작업을 위한 재사용 가능한 템플릿을 개발하고 싶습니다. "
            f"특히 창의성을 촉진하면서도 구조적 일관성을 제공하는 유연한 템플릿이 필요합니다."
        )
        
        builder.add_instructions([
            "창의적 작업을 위한 다양한 템플릿 구조(스토리텔링, 아이디어 발상, 디자인 사고 등)와 각각의 적합한 사용 상황을 설명해주세요",
            "다양한 창작 분야(글쓰기, 디자인, 비즈니스 아이디어 등)에 맞게 조정 가능한 템플릿 설계 방법을 제시해주세요",
            "구조적 일관성과 창의적 자유 사이의 균형을 유지하는 유연한 템플릿 시스템을 설명해주세요",
            "구체적이고 재사용 가능한 창작 템플릿 세트(최소 3-5개)를 마크다운 형식으로 제공해주세요",
            "템플릿의 효과적인 활용과 창의적 맥락에 맞는 맞춤화를 위한 실용적 지침을 제공해주세요"
        ])
        
    elif "의사결정 템플릿" in topic:
        builder.add_role(
            "의사결정 프레임워크 설계자", 
            "체계적이고 객관적인 선택과 문제 해결을 지원하는 재사용 가능한 프롬프트 템플릿을 설계하는 전문가입니다."
        )
        
        builder.add_context(
            f"저는 {topic}에 관심이 있습니다. "
            f"복잡한 선택 상황, 우선순위 설정, 문제 해결, 위험 분석 등을 위한 재사용 가능한 의사결정 템플릿을 개발하고 싶습니다. "
            f"특히 객관적 기준과 다양한 관점을 통합하여 더 나은 결정을 내릴 수 있는 체계적인 템플릿이 필요합니다."
        )
        
        builder.add_instructions([
            "체계적인 의사결정을 위한 다양한 템플릿 구조(비교 매트릭스, 의사결정 트리, 프로세스 맵 등)와 각각의 적합한 사용 상황을 설명해주세요",
            "다양한 의사결정 상황(개인적 선택, 비즈니스 전략, 리소스 할당 등)에 맞게 조정 가능한 템플릿 설계 방법을 제시해주세요",
            "객관적 기준, 주관적 선호도, 위험 요소, 불확실성 등을 균형있게 고려하는 템플릿 구조를 설명해주세요",
            "구체적이고 재사용 가능한 의사결정 템플릿 세트(최소 3-5개)를 마크다운 형식으로 제공해주세요",
            "템플릿의 효과적인 활용과 의사결정 상황에 맞는 맞춤화를 위한 실용적 지침을 제공해주세요"
        ])
        
    elif "템플릿 시스템" in topic:
        builder.add_role(
            "템플릿 시스템 아키텍트", 
            "다양한 목적과, 상황에 맞게 조정 가능한 유연하고 체계적인 프롬프트 템플릿 시스템을 설계하는 전문가입니다."
        )
        
        builder.add_context(
            f"저는 {topic}에 관심이 있습니다. "
            f"다양한 작업과 목적에 두루 활용할 수 있는 통합적이고 유연한 템플릿 시스템을 개발하고 싶습니다. "
            f"특히 일관된 구조를 유지하면서도 다양한 상황에 맞게 모듈식으로 조합하고 확장할 수 있는 템플릿 라이브러리가 필요합니다."
        )
        
        builder.add_instructions([
            "효과적인 템플릿 시스템의 핵심 원칙과 설계 철학을 설명해주세요",
            "템플릿의 모듈화, 변수 시스템, 조건부 요소 등 핵심 구성 요소를 설계하는 방법을 제시해주세요",
            "다양한 목적(분석, 교육, 창작, 의사결정 등)의 템플릿을 통합적으로 관리하고 조직화하는 시스템을 설명해주세요",
            "실용적인 템플릿 라이브러리 구조와 메타데이터 시스템을 마크다운 형식으로 제공해주세요",
            "템플릿 시스템의 효과적인 활용, 확장, 관리를 위한 포괄적인 지침을 제공해주세요"
        ])
        
    else:
        builder.add_role(
            "템플릿 설계 전문가", 
            "다양한 목적과 상황에 맞는 재사용 가능한 프롬프트 템플릿을 설계하고 최적화하는 전문가입니다."
        )
        
        builder.add_context(
            f"저는 {topic}에 관심이 있습니다. "
            f"반복적인 작업과 구조화된 결과물이 필요한 다양한 상황에서 활용할 수 있는 재사용 가능한 템플릿을 개발하고 싶습니다. "
            f"특히 다양한 맥락에 맞게 조정할 수 있는 유연성과 일관된 결과를 보장하는 구조적 견고함을 모두 갖춘 템플릿이 필요합니다."
        )
        
        builder.add_instructions([
            "효과적인 재사용 템플릿의 핵심 원칙과 설계 요소를 설명해주세요",
            "템플릿의 유연성과 일관성을 균형 있게 유지하는 설계 전략을 제시해주세요",
            "변수 시스템, 조건부 섹션, 모듈식 구성 등 고급 템플릿 기능을 구현하는 방법을 설명해주세요",
            "다양한 목적에 맞는 재사용 가능한 템플릿 예시를 마크다운 형식으로 제공해주세요",
            "템플릿의 효과적인 활용, 관리, 최적화를 위한 실용적 지침을 제공해주세요"
        ])
    
    # 출력 형식 지정
    builder.add_format_instructions(
        f"응답은 {output_format} 형식으로 구성해주세요. "
        f"마크다운 형식을 사용하여 다음 요소를 효과적으로 활용해주세요:\n\n"
        f"1. 명확한 제목 계층 구조 (##, ###, ####)\n"
        f"2. 글머리 기호와 번호 매기기를 적절히 활용한 목록\n"
        f"3. 표를 사용한 정보 비교 및 구조화\n"
        f"4. 인용문(>)을 활용한 중요 포인트 강조\n"
        f"5. 코드 블록을 활용한 템플릿 예시 표현\n"
        f"6. 굵은 글씨와 기울임체를 활용한 강조\n\n"
        f"다음 섹션을 포함해주세요:\n"
        f"1. 개요: 해당 템플릿 유형의 목적과 적합한 사용 상황\n"
        f"2. 템플릿 설계 원칙: 효과적인 템플릿 구성의 핵심 원칙\n"
        f"3. 변수 시스템: 조정 가능한 요소와 변수 활용법\n"
        f"4. 템플릿 라이브러리: 실제 사용 가능한 템플릿 세트(최소 3-5개)\n"
        f"5. 활용 지침: 템플릿 맞춤화 및 최적 활용 방법\n\n"
        f"각 템플릿은 재사용 가능한 형태로 제공하고, 변수와 조건부 섹션을 명확히 표시해주세요. "
        f"[변수명], [조건부 섹션], [*선택적요소] 등의 표기법을 일관되게 사용하고, "
        f"각 템플릿의 적절한 사용법과 변형 방법도 함께 설명해주세요."
    )
    
    return builder.build()

def main():
    """메인 함수"""
    # 실행 결과를 저장할 때 챕터별 폴더 구조를 사용
    run_exercise(
        title="재사용 가능한 템플릿 설계",
        topic_options=TEMPLATE_DESIGN_TOPICS,
        get_basic_prompt=get_basic_prompt,
        get_enhanced_prompt=get_enhanced_prompt,
        prompt_summary=PROMPT_SUMMARY,
        learning_points=LEARNING_POINTS
    )

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n프로그램이 사용자에 의해 중단되었습니다.")
    except Exception as err:
        print(f"\n오류 발생: {err}")
        print("API 키나 네트워크 연결을 확인하세요.")