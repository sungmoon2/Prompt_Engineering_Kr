"""
고급 프롬프트 워크플로우 설계 실습 모듈

Part 7 - 섹션 7.4.3 실습 코드: 프로젝트 전체에 걸친 체계적인 프롬프트 워크플로우를 설계하고 구현하는 방법을 학습합니다.
"""

import os
import sys
from typing import Dict, List, Any, Optional

# 상위 디렉토리를 경로에 추가하여 utils 모듈을 import할 수 있게 설정
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_dir)))
sys.path.append(project_root)

from utils.prompt_builder import PromptBuilder
from utils.exercise_template import run_exercise

# 주제 옵션 정의
WORKFLOW_DESIGN_TOPICS = {
    "1": {"name": "연구 워크플로우", "topic": "학술 연구 프로젝트를 위한 체계적 프롬프트 워크플로우 설계", "output_format": "연구 프로토콜"},
    "2": {"name": "학습 워크플로우", "topic": "복잡한 주제 학습을 위한 단계별 프롬프트 워크플로우 설계", "output_format": "학습 가이드"},
    "3": {"name": "콘텐츠 제작 워크플로우", "topic": "고품질 콘텐츠 제작을 위한 체계적 프롬프트 워크플로우 설계", "output_format": "제작 플레이북"},
    "4": {"name": "문제 해결 워크플로우", "topic": "복잡한 문제 해결을 위한 단계별 프롬프트 워크플로우 설계", "output_format": "솔루션 프레임워크"},
    "5": {"name": "의사결정 워크플로우", "topic": "중요한 의사결정을 위한 체계적 프롬프트 워크플로우 설계", "output_format": "의사결정 프로토콜"}
}

# 프롬프트 요약 정보
PROMPT_SUMMARY = {
    "basic": ["주제에 대한 직접적인 질문"],
    "enhanced": [
        "체계적 워크플로우: 프로젝트 전체를 단계별로 구분한 체계적 설계",
        "단계별 최적화: 각 단계에 최적화된 프롬프트 패턴 조합 적용",
        "연속성 관리: 각 단계 간 원활한 전환과 맥락 유지 전략",
        "피드백 통합: 이전 단계의 결과와 피드백을 다음 단계에 통합하는 방식"
    ]
}

# 학습 포인트
LEARNING_POINTS = [
    "복잡한 프로젝트는 단일 프롬프트보다 체계적인 프롬프트 워크플로우를 통해 더 효과적으로 관리할 수 있습니다",
    "각 프로젝트 단계에 맞춰 최적화된 프롬프트 패턴을 선택하고 조합하는 방법을 배울 수 있습니다",
    "단계 간 원활한 전환과 맥락 관리를 통해 프로젝트 전체의 일관성을 유지하는 전략을 익힐 수 있습니다",
    "피드백 루프를 워크플로우에 통합하여 프로젝트의 품질과 효과성을 지속적으로 개선하는 방법을 학습할 수 있습니다",
    "프로젝트 유형과 목표에 맞는 맞춤형 워크플로우 템플릿을 개발하고 재사용하는 방법을 배울 수 있습니다"
]

def get_basic_prompt(topic: str) -> str:
    """기본 프롬프트 생성"""
    return f"{topic}에 대해 알려주세요."

def get_enhanced_prompt(topic: str, purpose: str, output_format: str) -> str:
    """향상된 프롬프트 생성"""
    builder = PromptBuilder()
    
    # 주제별 워크플로우 설계 접근법
    if "연구 워크플로우" in topic or "학술 연구" in topic:
        # 역할 설정
        builder.add_role(
            "연구 워크플로우 설계 전문가", 
            "학술 연구 프로젝트를 체계적으로 설계하고 관리하는 전문가로, 연구 질문 개발부터 문헌 검토, 방법론 설계, 데이터 분석, 결과 해석, 논문 작성까지 연구 전 단계에 최적화된 프롬프트 워크플로우를 개발하는 데 깊은 전문성을 갖고 있습니다. 특히 각 연구 단계에 적합한 프롬프트 패턴 조합과 단계 간 연속성 관리 전략에 정통합니다."
        )
        
        # 맥락 설정
        builder.add_context(
            f"저는 대학원생으로 {topic}에 관심이 있습니다. "
            f"연구 프로젝트를 수행할 때, 일관되고 체계적인 접근법으로 AI의 도움을 받고 싶습니다. "
            f"단순히 산발적인 질문이 아니라, 연구의 각 단계에 최적화된 프롬프트 전략과 "
            f"단계 간 연속성을 유지하는 통합적인 워크플로우가 필요합니다. "
            f"연구 질문 개발부터 최종 논문 작성까지 전체 연구 과정을 효과적으로 지원할 수 있는 "
            f"체계적인 프롬프트 워크플로우 설계 방법을 배우고 싶습니다."
        )
        
        # 구체적인 지시사항
        builder.add_instructions([
            "1. 학술 연구 프로젝트의 주요 단계(최소 5-7단계)를 식별하고, 각 단계의 목표와 핵심 활동을 설명해주세요",
            "2. 각 연구 단계에 최적화된 프롬프트 패턴 조합을 제안하고, 왜 이 조합이 해당 단계에 적합한지 설명해주세요",
            "3. 연구 단계 간의 연속성을 유지하고 이전 단계의 결과를 다음 단계에 효과적으로 통합하는 구체적인 전략을 제시해주세요",
            "4. 각 연구 단계별로 실제 사용할 수 있는 구체적인 프롬프트 템플릿과 예시를 제공해주세요",
            "5. 연구 과정에서 발생할 수 있는 도전과제(방향성 상실, 막힘 상태, 방법론적 어려움 등)를 해결하기 위한 특화된 프롬프트 전략도 포함해주세요"
        ])
        
    elif "학습 워크플로우" in topic or "주제 학습" in topic:
        # 역할 설정
        builder.add_role(
            "학습 워크플로우 설계 전문가", 
            "복잡하고 추상적인 주제를 효과적으로 학습하기 위한 체계적인 프로세스를 설계하는 전문가로, 인지 과학과 교육심리학 원리에 기반한 단계별 학습 접근법과 각 학습 단계에 최적화된 프롬프트 전략 개발에 깊은 전문성을 갖고 있습니다. 특히 개념 이해, 비판적 분석, 실용적 적용, 지식 통합의 전 과정을 지원하는 통합적 학습 워크플로우 설계에 정통합니다."
        )
        
        # 맥락 설정
        builder.add_context(
            f"저는 대학생으로 {topic}에 관심이 있습니다. "
            f"복잡하고 추상적인 개념과 이론을 효과적으로 학습하고 싶습니다. "
            f"단순히 정보를 수집하는 것이 아니라, 개념을 깊이 이해하고, 비판적으로 분석하고, "
            f"실제 상황에 적용하고, 기존 지식과 통합하는 전체 학습 과정을 체계적으로 지원할 수 있는 "
            f"프롬프트 워크플로우가 필요합니다. 특히 인지 과학과 학습 이론에 기반한 효과적인 접근법을 "
            f"AI와의 상호작용에 적용하는 방법을 배우고 싶습니다."
        )
        
        # 구체적인 지시사항
        builder.add_instructions([
            "1. 복잡한 주제 학습의 주요 단계(최소 5-7단계)를 식별하고, 각 단계의 인지적 목표와 핵심 활동을 설명해주세요",
            "2. 각 학습 단계에 최적화된 프롬프트 패턴 조합을 제안하고, 왜 이 조합이 해당 인지 과정에 적합한지 설명해주세요",
            "3. 학습 단계 간의 연속성을 유지하고 점진적으로 이해를 심화시키는 구체적인 전략을 제시해주세요",
            "4. 각 학습 단계별로 실제 사용할 수 있는 구체적인 프롬프트 템플릿과 예시를 제공해주세요",
            "5. 학습 과정에서 발생할 수 있는 도전과제(개념적 혼란, 정보 과부하, 적용의 어려움 등)를 해결하기 위한 특화된 프롬프트 전략도 포함해주세요"
        ])
        
    elif "콘텐츠 제작 워크플로우" in topic or "콘텐츠 제작" in topic:
        # 역할 설정
        builder.add_role(
            "콘텐츠 제작 워크플로우 설계 전문가", 
            "고품질 콘텐츠를 체계적이고 효율적으로 제작하기 위한 프로세스를 설계하는 전문가로, 아이디어 발상부터 리서치, 구조 설계, 초안 작성, 편집, 최종화까지 콘텐츠 제작의 전 단계에 최적화된 프롬프트 전략 개발에 깊은 전문성을 갖고 있습니다. 특히 창의성과 품질을 균형 있게 촉진하는 통합적 워크플로우 설계에 정통합니다."
        )
        
        # 맥락 설정
        builder.add_context(
            f"저는 콘텐츠 크리에이터로 {topic}에 관심이 있습니다. "
            f"블로그 포스트, 에세이, 기사, 보고서 등 다양한 형태의 콘텐츠를 더 효과적이고 "
            f"효율적으로 제작하고 싶습니다. 단순히 초안 작성 도움이 아니라, 아이디어 발상부터 "
            f"리서치, 구조 설계, 초안 작성, 편집, 최종화까지 콘텐츠 제작의 전 과정을 체계적으로 "
            f"지원할 수 있는 프롬프트 워크플로우가 필요합니다. 창의성과 품질을 모두 높이는 "
            f"실용적인 접근법을 배우고 싶습니다."
        )
        
        # 구체적인 지시사항
        builder.add_instructions([
            "1. 고품질 콘텐츠 제작의 주요 단계(최소 5-7단계)를 식별하고, 각 단계의 목표와 핵심 활동을 설명해주세요",
            "2. 각 제작 단계에 최적화된 프롬프트 패턴 조합을 제안하고, 왜 이 조합이 해당 단계에 적합한지 설명해주세요",
            "3. 제작 단계 간의 연속성을 유지하고 콘텐츠의 일관성과 품질을 보장하는 구체적인 전략을 제시해주세요",
            "4. 각 제작 단계별로 실제 사용할 수 있는 구체적인 프롬프트 템플릿과 예시를 제공해주세요",
            "5. 콘텐츠 제작 과정에서 발생할 수 있는 도전과제(창작 블록, 일관성 유지, 퀄리티 관리 등)를 해결하기 위한 특화된 프롬프트 전략도 포함해주세요"
        ])
        
    elif "문제 해결 워크플로우" in topic or "문제 해결" in topic:
        # 역할 설정
        builder.add_role(
            "문제 해결 워크플로우 설계 전문가", 
            "복잡한 문제를 체계적이고 창의적으로 해결하기 위한 프로세스를 설계하는 전문가로, 문제 정의부터 정보 수집, 대안 생성, 평가, 실행 계획까지 문제 해결의 전 단계에 최적화된 프롬프트 전략 개발에 깊은 전문성을 갖고 있습니다. 특히 논리적 분석과 창의적 사고를 균형 있게 활용하는 통합적 워크플로우 설계에 정통합니다."
        )
        
        # 맥락 설정
        builder.add_context(
            f"저는 사업가/연구자로 {topic}에 관심이 있습니다. "
            f"비즈니스, 연구, 개발 등 다양한 영역에서 마주치는 복잡한 문제를 "
            f"더 체계적이고 효과적으로 해결하고 싶습니다. 단순한 해결책 제안이 아니라, "
            f"문제 정의부터 정보 수집, 대안 생성, 평가, 실행 계획까지 문제 해결의 전 과정을 "
            f"체계적으로 지원할 수 있는 프롬프트 워크플로우가 필요합니다. 특히 논리적 분석과 "
            f"창의적 발상을 균형 있게 활용하는 실용적인 접근법을 배우고 싶습니다."
        )
        
        # 구체적인 지시사항
        builder.add_instructions([
            "1. 체계적 문제 해결의 주요 단계(최소 5-7단계)를 식별하고, 각 단계의 목표와 핵심 활동을 설명해주세요",
            "2. 각 문제 해결 단계에 최적화된 프롬프트 패턴 조합을 제안하고, 왜 이 조합이 해당 단계에 적합한지 설명해주세요",
            "3. 문제 해결 단계 간의 연속성을 유지하고 일관된 접근법을 보장하는 구체적인 전략을 제시해주세요",
            "4. 각 문제 해결 단계별로 실제 사용할 수 있는 구체적인 프롬프트 템플릿과 예시를 제공해주세요",
            "5. 문제 해결 과정에서 발생할 수 있는 도전과제(문제 정의의 모호함, 편향된 사고, 고착화된 관점 등)를 극복하기 위한 특화된 프롬프트 전략도 포함해주세요"
        ])
        
    else:  # 의사결정 워크플로우
        # 역할 설정
        builder.add_role(
            "의사결정 워크플로우 설계 전문가", 
            "중요하고 복잡한 의사결정을 체계적이고 균형 있게 내리기 위한 프로세스를 설계하는 전문가로, 상황 분석부터 선택지 개발, 기준 설정, 평가, 검증, 실행 계획까지 의사결정의 전 단계에 최적화된 프롬프트 전략 개발에 깊은 전문성을 갖고 있습니다. 특히 인지적 편향을 최소화하고 다양한 관점을 통합하는 워크플로우 설계에 정통합니다."
        )
        
        # 맥락 설정
        builder.add_context(
            f"저는 관리자/전문가로 {topic}에 관심이 있습니다. "
            f"개인적, 학업적, 직업적 맥락에서 중요한 의사결정을 더 체계적이고 "
            f"균형 있게 내리고 싶습니다. 단순한 조언이 아니라, 상황 분석부터 "
            f"선택지 개발, 기준 설정, 평가, 검증, 실행 계획까지 의사결정의 전 과정을 "
            f"체계적으로 지원할 수 있는 프롬프트 워크플로우가 필요합니다. 특히 인지적 편향을 "
            f"최소화하고 다양한 관점을 균형 있게 고려하는 접근법을 배우고 싶습니다."
        )
        
        # 구체적인 지시사항
        builder.add_instructions([
            "1. 체계적 의사결정의 주요 단계(최소 5-7단계)를 식별하고, 각 단계의 목표와 핵심 활동을 설명해주세요",
            "2. 각 의사결정 단계에 최적화된 프롬프트 패턴 조합을 제안하고, 왜 이 조합이 해당 단계에 적합한지 설명해주세요",
            "3. 의사결정 단계 간의 연속성을 유지하고 일관된 접근법을 보장하는 구체적인 전략을 제시해주세요",
            "4. 각 의사결정 단계별로 실제 사용할 수 있는 구체적인 프롬프트 템플릿과 예시를 제공해주세요",
            "5. 의사결정 과정에서 발생할 수 있는 도전과제(인지적 편향, 불확실성, 상충하는 기준 등)를 극복하기 위한 특화된 프롬프트 전략도 포함해주세요"
        ])
    
    # 출력 형식 지정
    builder.add_format_instructions(
        f"응답은 {output_format} 형식으로 구성해주세요. "
        f"마크다운 형식을 사용하여 제목, 소제목, 목록 등을 명확히 구분해주세요. "
        f"다음 섹션들을 포함해주세요:\n\n"
        f"1. **워크플로우 개요**: 전체 프로세스의 목적과 구조에 대한 요약\n"
        f"2. **단계별 프로세스**: 각 단계의 목표, 활동, 최적 프롬프트 패턴 조합 설명\n"
        f"3. **연속성 관리 전략**: 단계 간 전환과 맥락 유지 방법\n"
        f"4. **프롬프트 템플릿 라이브러리**: 각 단계별 구체적인 프롬프트 템플릿과 예시\n"
        f"5. **도전과제 대응 전략**: 과정에서 발생할 수 있는 어려움과 해결 접근법\n\n"
        f"각 섹션에서 실제 적용 가능한 구체적인 예시, 템플릿, 워크플로우를 제공해주세요. "
        f"가능한 다이어그램, 플로우차트, 프로세스 맵 등 시각적 요소를 활용하여 워크플로우를 명확하게 표현해주세요."
    )
    
    return builder.build()

def main():
    """메인 함수"""
    # 실행 결과를 저장할 때 챕터별 폴더 구조를 사용
    run_exercise(
        title="고급 프롬프트 워크플로우 설계",
        topic_options=WORKFLOW_DESIGN_TOPICS,
        get_basic_prompt=get_basic_prompt,
        get_enhanced_prompt=get_enhanced_prompt,
        prompt_summary=PROMPT_SUMMARY,
        learning_points=LEARNING_POINTS
    )

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n프로그램이 사용자에 의해 중단되었습니다.")
    except Exception as err:
        print(f"\n오류 발생: {err}")
        print("API 키나 네트워크 연결을 확인하세요.")