"""
복잡한 학기 프로젝트 실습 모듈

Part 7 - 섹션 7.4.1 실습 코드: 복잡한 학기 프로젝트를 위한 고급 프롬프트 패턴 조합 전략을 학습합니다.
"""

import os
import sys
from typing import Dict, List, Any, Optional

# 상위 디렉토리를 경로에 추가하여 utils 모듈을 import할 수 있게 설정
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_dir)))
sys.path.append(project_root)

from utils.prompt_builder import PromptBuilder
from utils.exercise_template import run_exercise

# 주제 옵션 정의
COMPLEX_PROJECT_TOPICS = {
    "1": {"name": "문헌 연구", "topic": "광범위한 문헌 연구를 위한 프롬프트 패턴 조합", "output_format": "연구 계획서"},
    "2": {"name": "데이터 분석", "topic": "복잡한 데이터 분석 프로젝트를 위한 프롬프트 패턴 조합", "output_format": "분석 프레임워크"},
    "3": {"name": "창의적 논문", "topic": "창의적 논문 작성을 위한 프롬프트 패턴 조합", "output_format": "논문 로드맵"},
    "4": {"name": "팀 프로젝트", "topic": "여러 사람이 참여하는 팀 프로젝트를 위한 프롬프트 패턴 조합", "output_format": "협업 가이드"},
    "5": {"name": "융합 연구", "topic": "여러 학문 분야를 융합한 연구 프로젝트를 위한 프롬프트 패턴 조합", "output_format": "융합 연구 설계"}
}

# 프롬프트 요약 정보
PROMPT_SUMMARY = {
    "basic": ["주제에 대한 직접적인 질문"],
    "enhanced": [
        "역할 기반 프롬프팅: 여러 전문가 역할 조합",
        "단계적 사고 유도: 복잡한, 단계적 접근법 요청",
        "맥락 관리: 학기 프로젝트 전 과정 고려",
        "구조화된 출력: 체계적인 프레임워크와 템플릿 요청"
    ]
}

# 학습 포인트
LEARNING_POINTS = [
    "복잡한 학기 프로젝트는 여러 프롬프트 패턴을 전략적으로 조합해야 합니다",
    "역할 기반 프롬프팅과 단계적 사고 유도를 결합하면 더 심층적인 분석이 가능합니다",
    "구조화된 출력 요청과 맥락 관리를 통합하면 장기 프로젝트의 일관성을 유지할 수 있습니다",
    "프로젝트 유형과 단계에 따라 적절한 프롬프트 패턴 조합을 선택하는 것이 중요합니다",
    "여러 패턴을 결합할 때는 각 요소의 균형과 명확성을 유지해야 합니다"
]

def get_basic_prompt(topic: str) -> str:
    """기본 프롬프트 생성"""
    return f"{topic}에 대해 알려주세요."

def get_enhanced_prompt(topic: str, purpose: str, output_format: str) -> str:
    """향상된 프롬프트 생성"""
    builder = PromptBuilder()
    
    # 프로젝트 유형에 따른 역할 및 지시사항 설정
    if "문헌 연구" in topic:
        # 역할 기반 프롬프팅: 다중 역할 설정
        builder.add_role(
            "학술 문헌 연구 전략가", 
            "다양한 학문 분야의 문헌을 체계적으로 탐색, 분석, 종합하는 전문가로, 특히 장기적인 문헌 연구 프로젝트를 위한 효과적인 전략과 프레임워크를 개발하는 데 전문성을 갖고 있습니다. 또한 문헌 리뷰 구조화, 비판적 분석, 연구 갭 식별에 깊은 지식을 보유하고 있습니다."
        )
        
        # 맥락 설정
        builder.add_context(
            f"저는 대학원생으로 한 학기 동안 진행해야 하는 광범위한 문헌 연구 프로젝트를 앞두고 있습니다. "
            f"{topic}에 대한 체계적인 접근법을 개발하고자 합니다. 단순한 조언이 아닌, 문헌 연구의 전 과정을 "
            f"효과적으로 관리하고 고품질의 결과물을 도출할 수 있는 통합적인 전략이 필요합니다. "
            f"특히 역할 기반 프롬프팅, 단계적 사고 유도, 구조화된 출력 요청과 같은 고급 프롬프트 패턴을 "
            f"어떻게 조합하여 활용할 수 있는지 알고 싶습니다."
        )
        
        # 복합적 지시사항: 여러 프롬프트 패턴 조합
        builder.add_instructions([
            "1. 문헌 연구 프로젝트의 주요 단계와 각 단계에서 활용할 수 있는 가장 효과적인 프롬프트 패턴 조합을 제안해주세요",
            "2. 문헌 검색 및 선별 과정에서 AI에게 어떤 역할을 부여하고, 어떤 단계적 사고 과정을 요청해야 가장 효과적인지 설명해주세요",
            "3. 문헌 분석 및 종합 단계에서 활용할 수 있는 구조화된 출력 형식과 템플릿을 제공해주세요",
            "4. 문헌 연구 과정에서 발생할 수 있는 도전과제와 이를 해결하기 위한 특화된 프롬프트 전략을 제안해주세요",
            "5. 연구 질문 정교화부터 최종 리뷰 작성까지 전체 프로젝트 흐름에 따른 프롬프트 워크플로우를 설계해주세요"
        ])

    elif "데이터 분석" in topic:
        # 역할 기반 프롬프팅: 다중 역할 설정
        builder.add_role(
            "데이터 분석 전략가", 
            "복잡한 데이터 분석 프로젝트를 설계하고 실행하는 전문가로, 데이터 전처리부터 고급 분석, 시각화, 결과 해석까지 전 과정을 체계적으로 관리합니다. 동시에 AI를 활용한 데이터 분석 워크플로우 최적화와 결과 품질 향상에 깊은 전문성을 갖고 있습니다."
        )
        
        # 맥락 설정
        builder.add_context(
            f"저는 대학원생으로 한 학기 동안 진행할 복잡한 데이터 분석 프로젝트를 계획하고 있습니다. "
            f"{topic}에 대한 체계적인 접근법을 개발하고자 합니다. 데이터 수집부터 전처리, 분석, "
            f"결과 해석 및 시각화까지 전체 과정을 효과적으로 관리하고 AI의 도움을 최대한 활용할 수 있는 "
            f"통합적인 전략이 필요합니다. 특히 여러 고급 프롬프트 패턴을 어떻게 전략적으로 조합하여 "
            f"데이터 분석의 질과 효율성을 높일 수 있는지 알고 싶습니다."
        )
        
        # 복합적 지시사항: 여러 프롬프트 패턴 조합
        builder.add_instructions([
            "1. 데이터 분석 프로젝트의 주요 단계와 각 단계에서 활용할 수 있는 최적의 프롬프트 패턴 조합을 제안해주세요",
            "2. 데이터 전처리 및 탐색적 분석 단계에서 AI에게 어떤 역할을 부여하고, 어떤 단계적 사고 과정을 요청해야 가장 효과적인지 설명해주세요",
            "3. 복잡한 통계 분석 및 모델링 과정에서 활용할 수 있는 구조화된 출력 형식과 템플릿을 제공해주세요",
            "4. 데이터 해석 및 시각화 단계에서 발생할 수 있는 도전과제와 이를 해결하기 위한 특화된 프롬프트 전략을 제안해주세요",
            "5. 연구 질문 설정부터 최종 결과 보고서 작성까지 전체 프로젝트 흐름에 따른 프롬프트 워크플로우를 설계해주세요"
        ])

    elif "창의적 논문" in topic:
        # 역할 기반 프롬프팅: 다중 역할 설정
        builder.add_role(
            "학술 논문 개발 전략가", 
            "창의적이고 혁신적인 학술 논문을 구상하고 발전시키는 전문가로, 연구 질문 설정부터 문헌 검토, 방법론 개발, 논증 구조화, 학술적 글쓰기까지 논문 작성 전 과정에 대한 깊은 이해를 갖추고 있습니다. 특히 AI를 활용한 창의적 사고 촉진과 학술적 엄밀성 유지 방법에 전문성을 가지고 있습니다."
        )
        
        # 맥락 설정
        builder.add_context(
            f"저는 대학원생으로 이번 학기에 창의적이고 혁신적인 논문을 작성해야 합니다. "
            f"{topic}에 대한 체계적이면서도 창의적인 접근법을 개발하고자 합니다. "
            f"연구 질문 설정부터 문헌 검토, 방법론 개발, 논증 구조화, 학술적 글쓰기까지 "
            f"논문 작성의 전 과정에서 AI의 도움을 최대한 활용하고 싶습니다. 특히 역할 기반 프롬프팅, "
            f"단계적 사고 유도, 창의적 발상 기법 등 여러 고급 프롬프트 패턴을 어떻게 조합하여 "
            f"학술적 엄밀성을 유지하면서도 창의적인 논문을 개발할 수 있는지 알고 싶습니다."
        )
        
        # 복합적 지시사항: 여러 프롬프트 패턴 조합
        builder.add_instructions([
            "1. 창의적 논문 작성 프로젝트의 주요 단계와 각 단계에서 활용할 수 있는 최적의 프롬프트 패턴 조합을 제안해주세요",
            "2. 연구 질문 개발 및 문헌 검토 단계에서 AI에게 어떤 역할을 부여하고, 어떤 단계적 사고 과정을 요청해야 가장 효과적인지 설명해주세요",
            "3. 방법론 개발 및 논증 구조화 과정에서 활용할 수 있는 구조화된 출력 형식과 템플릿을 제공해주세요",
            "4. 학술적 글쓰기 단계에서 발생할 수 있는 도전과제와 이를 해결하기 위한 특화된 프롬프트 전략을 제안해주세요",
            "5. 아이디어 발상부터 최종 논문 완성까지 전체 프로젝트 흐름에 따른 프롬프트 워크플로우를 설계해주세요"
        ])

    elif "팀 프로젝트" in topic:
        # 역할 기반 프롬프팅: 다중 역할 설정
        builder.add_role(
            "협업 프로젝트 전략가", 
            "여러 사람이 참여하는 복잡한 팀 프로젝트를 효과적으로 조직하고 관리하는 전문가로, 역할 분담, 의사소통, 일정 관리, 품질 보증 등 협업 프로젝트의 모든 측면에 대한 깊은 이해를 갖추고 있습니다. 특히 AI를 활용한 팀 협업 최적화와 프로젝트 성과 향상 방법에 전문성을 가지고 있습니다."
        )
        
        # 맥락 설정
        builder.add_context(
            f"저는 대학원생으로 이번 학기에 여러 명이 참여하는 팀 프로젝트를 이끌어야 합니다. "
            f"{topic}에 대한 체계적이고 효과적인 접근법을 개발하고자 합니다. "
            f"역할 분담, 의사소통, 일정 관리, 품질 보증 등 협업 프로젝트의 모든 측면에서 "
            f"AI의 도움을 최대한 활용하고 싶습니다. 특히 역할 기반 프롬프팅, 단계적 사고 유도, "
            f"구조화된 출력 요청 등 여러 고급 프롬프트 패턴을 어떻게 전략적으로 조합하여 "
            f"팀원 간 협업의 질과 효율성을 높일 수 있는지 알고 싶습니다."
        )
        
        # 복합적 지시사항: 여러 프롬프트 패턴 조합
        builder.add_instructions([
            "1. 팀 프로젝트의 주요 단계와 각 단계에서 활용할 수 있는 최적의 프롬프트 패턴 조합을 제안해주세요",
            "2. 프로젝트 계획 및 역할 분담 단계에서 AI에게 어떤 역할을 부여하고, 어떤 단계적 사고 과정을 요청해야 가장 효과적인지 설명해주세요",
            "3. 팀 의사소통 및 진행 상황 추적을 위한 구조화된 출력 형식과 템플릿을 제공해주세요",
            "4. 팀 구성원 간 의견 불일치 및 일정 지연과 같은 도전과제를 해결하기 위한 특화된 프롬프트 전략을 제안해주세요",
            "5. 프로젝트 초기 구상부터 최종 결과물 제출까지 전체 프로젝트 흐름에 따른 프롬프트 워크플로우를 설계해주세요"
        ])

    else:  # 융합 연구
        # 역할 기반 프롬프팅: 다중 역할 설정
        builder.add_role(
            "학제간 융합 연구 전략가", 
            "여러 학문 분야를 창의적으로 통합하여 혁신적인 연구를 설계하고 수행하는 전문가로, 다양한 지식 체계의 연결점 식별, 융합적 방법론 개발, 학제간 의사소통 촉진에 깊은 이해를 갖추고 있습니다. 특히 AI를 활용한 학제간 지식 통합과 융합 연구 품질 향상 방법에 전문성을 가지고 있습니다."
        )
        
        # 맥락 설정
        builder.add_context(
            f"저는 대학원생으로 이번 학기에 여러 학문 분야를 융합한 연구 프로젝트를 수행해야 합니다. "
            f"{topic}에 대한 체계적이고 창의적인 접근법을 개발하고자 합니다. "
            f"서로 다른 학문 분야의 지식과 방법론을 효과적으로 통합하고, 학제간 소통의 장벽을 극복하며, "
            f"융합적 사고를 촉진하는 과정에서 AI의 도움을 최대한 활용하고 싶습니다. 특히 역할 기반 프롬프팅, "
            f"단계적 사고 유도, 다중 관점 탐색 등 여러 고급 프롬프트 패턴을 어떻게 전략적으로 조합하여 "
            f"융합 연구의 질과 창의성을 높일 수 있는지 알고 싶습니다."
        )
        
        # 복합적 지시사항: 여러 프롬프트 패턴 조합
        builder.add_instructions([
            "1. 융합 연구 프로젝트의 주요 단계와 각 단계에서 활용할 수 있는 최적의 프롬프트 패턴 조합을 제안해주세요",
            "2. 서로 다른 학문 분야의 지식과 방법론을 통합하는 과정에서 AI에게 어떤 역할을 부여하고, 어떤 단계적 사고 과정을 요청해야 가장 효과적인지 설명해주세요",
            "3. 융합적 연구 질문 개발 및 방법론 설계를 위한 구조화된 출력 형식과 템플릿을 제공해주세요",
            "4. 학제간 소통 장벽 및 지식 통합의 어려움과 같은 도전과제를 해결하기 위한 특화된 프롬프트 전략을 제안해주세요",
            "5. 융합적 아이디어 발상부터 최종 연구 결과물 완성까지 전체 프로젝트 흐름에 따른 프롬프트 워크플로우를 설계해주세요"
        ])
    
    # 출력 형식 지정: 구조화된 출력 요청
    builder.add_format_instructions(
        f"응답은 {output_format} 형식으로 구성해주세요. "
        f"마크다운 형식을 사용하여 제목, 소제목, 목록 등을 명확히 구분해주세요. "
        f"다음 섹션들을 포함해주세요:\n\n"
        f"1. **프로젝트 개요 및 목표**: 프로젝트 유형과 이를 위한 프롬프트 전략의 핵심 원칙\n"
        f"2. **프롬프트 패턴 조합 전략**: 어떤 패턴들을 어떻게 조합하는지와 그 이유\n"
        f"3. **단계별 프롬프트 워크플로우**: 프로젝트 단계별 최적의 프롬프트 접근법\n"
        f"4. **프롬프트 템플릿과 예시**: 각 단계에서 활용할 수 있는 실제 템플릿\n"
        f"5. **도전과제 및 해결 전략**: 예상되는 어려움과 이를 극복하기 위한 프롬프트 전략\n\n"
        f"각 섹션에서 실제 대학원생이 즉시 활용할 수 있는 구체적인 예시, 템플릿, 워크플로우를 제공해주세요. "
        f"가능한 표, 다이어그램, 플로우차트 등 시각적 요소를 활용하여 정보를 명확하게 구조화해주세요."
    )
    
    return builder.build()

def main():
    """메인 함수"""
    # 실행 결과를 저장할 때 챕터별 폴더 구조를 사용
    run_exercise(
        title="실제 사례: 복잡한 학기 프로젝트",
        topic_options=COMPLEX_PROJECT_TOPICS,
        get_basic_prompt=get_basic_prompt,
        get_enhanced_prompt=get_enhanced_prompt,
        prompt_summary=PROMPT_SUMMARY,
        learning_points=LEARNING_POINTS
    )

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n프로그램이 사용자에 의해 중단되었습니다.")
    except Exception as err:
        print(f"\n오류 발생: {err}")
        print("API 키나 네트워크 연결을 확인하세요.")