"""
역할 기반 프롬프팅 실습 모듈

Part 7 - 섹션 7.1 실습 코드: 효과적인 역할 기반 프롬프팅 기법을 학습하고 
다양한 역할 설정 전략을 실습합니다.
"""

import os
import sys
from typing import Dict, List, Any, Optional

# 상위 디렉토리를 경로에 추가하여 utils 모듈을 import할 수 있게 설정
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_dir)))
sys.path.append(project_root)

from utils.prompt_builder import PromptBuilder
from utils.exercise_template import run_exercise

# 주제 옵션 정의
ROLE_PROMPTING_TOPICS = {
    "1": {"name": "투자 조언", "topic": "장기 투자 전략", "output_format": "투자 가이드"},
    "2": {"name": "기술 문제 해결", "topic": "웹 애플리케이션 성능 최적화", "output_format": "기술 문서"},
    "3": {"name": "교육 컨텐츠 개발", "topic": "효과적인 온라인 학습 경험 설계", "output_format": "교육 전략 보고서"},
    "4": {"name": "건강 관리 조언", "topic": "맞춤형 웰니스 계획", "output_format": "건강 관리 프로그램"},
    "5": {"name": "비즈니스 전략", "topic": "소규모 비즈니스 성장 전략", "output_format": "전략 계획"}
}

# 프롬프트 요약 정보
PROMPT_SUMMARY = {
    "basic": ["역할 설정 없는 일반적인 질문"],
    "enhanced": [
        "구체적 역할 설정: 경력, 전문분야, 성과 등 상세 정보 포함",
        "역할 사고방식 정의: 문제 접근법, 분석 프레임워크, 가치관 명시",
        "맥락 풍부화: 역할의 상황적 맥락과 청중 정보 추가",
        "메타인지적 요소: 사고 과정과 분석 방식 노출 요청"
    ]
}

# 학습 포인트
LEARNING_POINTS = [
    "역할 기반 프롬프팅은 더 전문적이고 맥락에 맞는 응답을 생성하는 효과적인 기법입니다",
    "구체적이고 명확한 역할 설정은 AI가 해당 분야의 지식과 관점을 적용하는 데 도움을 줍니다",
    "전문가 페르소나를 계층적으로 구체화하면 더 심층적이고 전문적인 결과를 얻을 수 있습니다",
    "다중 역할 접근법은 복잡한 문제에 대한 다양한 관점과 통합적 이해를 제공합니다",
    "역할의 한계와 제약을 명시하면 더 현실적이고 집중된 응답을 얻을 수 있습니다"
]

def get_basic_prompt(topic: str) -> str:
    """기본 프롬프트 생성"""
    return f"{topic}에 대한 가이드를 제공해주세요."

def get_enhanced_prompt(topic: str, purpose: str, output_format: str) -> str:
    """향상된 프롬프트 생성"""
    builder = PromptBuilder()
    
    # 주제별 역할 및 맥락 설정
    if "투자" in topic:
        builder.add_role(
            "자산관리 전문가", 
            "20년 이상의 경력을 가진 국제 공인 재무설계사(CFP)이자 자산관리 컨설턴트로, 다양한 시장 주기를 경험하며 고객의 장기 재무 목표 달성을 돕고 있습니다. 주요 투자 금융 기관에서 근무한 경험이 있으며, 리스크 관리와 분산 투자 전략 개발에 전문성을 갖추고 있습니다."
        )
        
        builder.add_context(
            f"저는 {topic}에 대한 전문적인 조언이 필요한 30대 중반의 전문직 종사자입니다. "
            f"현재 일정한 소득이 있고 은퇴를 위한 장기 투자를 시작하려고 합니다. "
            f"투자 초보자로서 불확실한 경제 상황에서도 안정적으로 자산을 성장시킬 수 있는 방법에 대한 "
            f"체계적이고 실용적인 가이드가 필요합니다."
        )
        
        builder.add_instructions([
            "투자 초보자를 위한 장기 투자 원칙과 핵심 개념을 명확히 설명해주세요",
            "다양한 투자 자산군(주식, 채권, 부동산, ETF 등)의 특성과 장단점을 비교 분석해주세요",
            "시장 변동성에 대응하는 분산 투자 전략과 자산 배분 방법을 제시해주세요",
            "현재 경제 상황을 고려한 투자 접근법과 주의해야 할 점을 설명해주세요",
            "투자 초보자가 흔히 범하는 실수와 이를 피하는 방법도 포함해주세요"
        ])
        
    elif "성능 최적화" in topic:
        builder.add_role(
            "풀스택 성능 최적화 전문가", 
            "15년 경력의 시니어 소프트웨어 엔지니어로, 대규모 트래픽을 처리하는 웹 애플리케이션의 성능 최적화에 전문성을 갖고 있습니다. 주요 기술 기업에서 성능 개선 팀을 이끌었으며, 프론트엔드부터 백엔드, 데이터베이스까지 전체 스택의 최적화 경험을 보유하고 있습니다. 또한 성능 측정 및 모니터링 시스템 구축에도 전문성이 있습니다."
        )
        
        builder.add_context(
            f"저는 중소 규모의 SaaS 회사에서 일하는 개발자로, {topic}에 관심이 있습니다. "
            f"최근 우리 웹 애플리케이션의 사용자가 증가하면서 로딩 시간이 느려지고 전반적인 성능 문제가 "
            f"발생하고 있습니다. 제한된 리소스와 인력으로 최대한 효율적으로 성능을 개선하는 방법에 대한 "
            f"실용적이고 체계적인 접근법이 필요합니다."
        )
        
        builder.add_instructions([
            "웹 애플리케이션 성능 최적화를 위한 체계적인 접근법과 진단 방법을 설명해주세요",
            "프론트엔드(로딩 시간, 렌더링 최적화 등)와 백엔드(서버 처리, 데이터베이스 쿼리 등) 최적화 전략을 구분하여 제시해주세요",
            "성능 병목 현상을 식별하고 측정하는 도구와 방법론을 추천해주세요",
            "제한된 리소스로 최대 효과를 낼 수 있는 '빠른 승리(quick wins)' 전략과 장기적 개선 전략을 구분하여 제안해주세요",
            "최적화 과정을 단계별로 구조화하고, 각 단계에서 주의해야 할 함정이나 오해도 설명해주세요"
        ])
        
    elif "온라인 학습" in topic:
        builder.add_role(
            "교육 경험 설계 전문가", 
            "교육 기술과 학습 설계 분야에서 12년의 경력을 가진 전문가로, 세계적인 교육 플랫폼과 대학에서 혁신적인 온라인 학습 경험을 개발했습니다. 학습 과학(Learning Science)과 교육심리학 배경을 갖추고 있으며, 학습자 참여와 정보 유지를 최적화하는 디지털 학습 환경 설계에 전문성이 있습니다. 다양한 교육 기술 프로젝트에서 수상 경력도 보유하고 있습니다."
        )
        
        builder.add_context(
            f"저는 소규모 교육 기관의 교육 담당자로, {topic}에 관심이 있습니다. "
            f"대면 교육 프로그램을 온라인 형식으로 전환하는 과정에서 학습자 참여도와 학습 효과를 "
            f"최대화할 수 있는 방법을 찾고 있습니다. 다양한 연령대와 배경을 가진 학습자들에게 "
            f"효과적인 온라인 학습 경험을 제공하기 위한 설계 원칙과 실용적인 전략이 필요합니다."
        )
        
        builder.add_instructions([
            "효과적인 온라인 학습 경험의 핵심 원칙과 설계 프레임워크를 설명해주세요",
            "학습자 참여와 동기 부여를 높이는 구체적인 온라인 교육 전략과 기법을 제안해주세요",
            "온라인 학습의 다양한 요소(콘텐츠, 활동, 평가, 상호작용 등)를 효과적으로 구성하는 방법을 설명해주세요",
            "다양한 학습 스타일과 요구를 수용하는 포용적인 온라인 학습 환경 설계 방법을 제시해주세요",
            "제한된 예산과 기술 리소스로도 구현 가능한 실용적인 접근법과 도구 추천도 포함해주세요"
        ])
        
    elif "건강 관리" in topic:
        builder.add_role(
            "통합 건강 관리 전문가", 
            "예방 의학과 통합 건강 관리 분야에서 17년의 경력을 가진 전문가로, 의학 박사이자 영양학, 운동 생리학, 행동 심리학에 대한 추가 교육을 받았습니다. 개인의 생활 방식, 유전적 요인, 환경적 영향을 고려한 맞춤형 건강 프로그램 개발에 전문성이 있으며, 예방 중심의 건강 관리 접근법과 습관 형성에 기반한 지속 가능한 건강 개선 전략을 강조합니다."
        )
        
        builder.add_context(
            f"저는 30대 중반의 직장인으로, {topic}에 관심이 있습니다. "
            f"장시간 앉아서 일하는 직업과 바쁜 일정으로 인해 건강 관리에 어려움을 겪고 있으며, "
            f"스트레스 관리, 에너지 수준 개선, 전반적인 웰빙을 위한 실용적인 접근법을 찾고 있습니다. "
            f"특별한 건강 문제는 없지만 예방적 관점에서 장기적인 건강을 유지하고 개선하고 싶습니다."
        )
        
        builder.add_instructions([
            "바쁜 현대인을 위한 통합적 웰니스 접근법의 핵심 원칙과 구성 요소를 설명해주세요",
            "제한된 시간과 자원으로도 실천 가능한 영양, 운동, 스트레스 관리, 수면 개선 전략을 제안해주세요",
            "일상에 건강한 습관을 통합하는 실용적인 방법과 점진적 변화 접근법을 설명해주세요",
            "개인의 특성, 선호도, 생활 방식에 맞게 웰니스 계획을 맞춤화하는 프레임워크를 제공해주세요",
            "지속 가능한 건강 습관 형성을 위한 동기 부여 전략과 일반적인 장애물 극복 방법도 포함해주세요"
        ])
        
    elif "비즈니스 성장" in topic:
        builder.add_role(
            "중소기업 성장 전략가", 
            "중소기업 컨설팅과 비즈니스 개발 분야에서 18년의 경력을 가진 전문가로, 200개 이상의 중소기업의 성장 전략 수립을 지원한 경험이 있습니다. MBA와 디지털 마케팅 분야의 전문 자격증을 보유하고 있으며, 제한된 자원으로 최대 효과를 내는 전략적 접근법과 실용적인 비즈니스 성장 모델 개발에 전문성이 있습니다. 또한 여러 스타트업의 자문 역할로 활동하고 있습니다."
        )
        
        builder.add_context(
            f"저는 3년차 소규모 서비스 비즈니스 운영자로, {topic}에 관심이 있습니다. "
            f"안정적인 고객층을 확보했지만 비즈니스를 다음 단계로 성장시키는 방법에 대해 고민하고 있습니다. "
            f"제한된 예산과 인력으로 효과적으로 시장 점유율을 확대하고 수익성을 개선할 수 있는 "
            f"체계적이고 실행 가능한 전략이 필요합니다."
        )
        
        builder.add_instructions([
            "소규모 비즈니스의 지속 가능한 성장을 위한 핵심 원칙과 전략적 프레임워크를 설명해주세요",
            "제한된 자원으로 최대 효과를 낼 수 있는 마케팅, 고객 확보, 고객 유지 전략을 제안해주세요",
            "비즈니스 확장 옵션(신규 서비스/제품, 새로운 시장, 파트너십 등)과 각 접근법의 장단점을 분석해주세요",
            "운영 효율성과 수익성을 개선하기 위한 체계적인 방법과 프로세스 최적화 전략을 설명해주세요",
            "성장 과정에서 흔히 발생하는 도전과제와 함정을 피하는 방법도 포함해주세요"
        ])
        
    else:
        builder.add_role(
            "분야 전문가", 
            f"{topic} 분야에서 15년 이상의 경력을 가진 전문가로, 다양한 관련 프로젝트를 성공적으로 이끈 경험과 깊은 지식을 보유하고 있습니다."
        )
        
        builder.add_context(
            f"저는 {topic}에 관심이 있는 초보자입니다. "
            f"이 분야에 대한 체계적이고 실용적인 가이드가 필요합니다. "
            f"기본 개념부터 실전 적용까지 단계별로 이해하고 싶습니다."
        )
        
        builder.add_instructions([
            f"{topic}의 핵심 원칙과 개념을 명확히 설명해주세요",
            "초보자가 알아야 할 기본 요소와 접근법을 단계별로 안내해주세요",
            "실제 적용을 위한 구체적인 전략과 방법을 제시해주세요",
            "자주 발생하는 문제와 해결 방법에 대한 인사이트를 공유해주세요",
            "장기적인 발전을 위한 로드맵과 리소스도 추천해주세요"
        ])
    
    # 출력 형식 지정
    builder.add_format_instructions(
        f"응답은 {output_format} 형식으로 구성해주세요. "
        f"마크다운 형식을 사용하여 제목, 소제목, 목록 등을 명확히 구분해주세요. "
        f"실용적이고 구체적인 정보와 함께 맥락에 맞는 전문적 용어를 적절히 사용해주세요. "
        f"가능한 경우 단계별 접근법, 체크리스트, 또는 프레임워크를 포함하여 실행 가능한 가이드를 제공해주세요. "
        f"필요한 경우 관련 사례나 예시를 통해 개념을 명확히 설명해주세요. "
        f"메타인지적 접근으로, 특정 제안이나 접근법을 선택한 이유나 사고 과정도 일부 공유해주세요."
    )
    
    return builder.build()

def main():
    """메인 함수"""
    # 실행 결과를 저장할 때 챕터별 폴더 구조를 사용
    run_exercise(
        title="역할 기반 프롬프팅 마스터하기",
        topic_options=ROLE_PROMPTING_TOPICS,
        get_basic_prompt=get_basic_prompt,
        get_enhanced_prompt=get_enhanced_prompt,
        prompt_summary=PROMPT_SUMMARY,
        learning_points=LEARNING_POINTS
    )

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n프로그램이 사용자에 의해 중단되었습니다.")
    except Exception as err:
        print(f"\n오류 발생: {err}")
        print("API 키나 네트워크 연결을 확인하세요.")