"""
경영학 케이스 스터디 vs 심리학 실험 설계 실습 모듈

Part 6 - 섹션 6.4.2 실습 코드: 경영학과 심리학 분야의 대표적 연구 방법론 차이를 이해하고
각 분야에 맞는 최적화된 프롬프트 작성법을 학습합니다.
"""

import os
import sys
from typing import Dict, List, Any, Optional

# 상위 디렉토리를 경로에 추가하여 utils 모듈을 import할 수 있게 설정
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_dir)))
sys.path.append(project_root)

from utils.prompt_builder import PromptBuilder
from utils.exercise_template import run_exercise

# 주제 옵션 정의
RESEARCH_METHODOLOGY_TOPICS = {
    "1": {"name": "경영학 케이스 스터디", "topic": "경영학 케이스 스터디 방법론", "output_format": "연구 가이드"},
    "2": {"name": "심리학 실험 설계", "topic": "심리학 실험 설계 방법론", "output_format": "연구 가이드"},
    "3": {"name": "방법론 비교", "topic": "경영학 케이스 스터디와 심리학 실험 설계의 비교", "output_format": "비교 분석"},
    "4": {"name": "현상 분석 접근법", "topic": "동일 현상에 대한 경영학과 심리학의 접근법 차이", "output_format": "다중 관점 분석"},
    "5": {"name": "통합 연구 방법", "topic": "경영학과 심리학 방법론을 통합한 연구 접근법", "output_format": "통합 연구 프레임워크"}
}

# 프롬프트 요약 정보
PROMPT_SUMMARY = {
    "basic": ["연구 방법론에 대한 일반적인 질문"],
    "enhanced": [
        "분야 특화 전문성: 해당 분야의 연구 방법론 전문가 역할 부여",
        "맥락 설정: 구체적인 학술적/연구적 상황과 목표 제시",
        "방법론 상세화: 각 연구 방법의 단계별 실행 과정 요청",
        "실제 적용: 구체적 사례나 주제에 적용한 예시 요청"
    ]
}

# 학습 포인트
LEARNING_POINTS = [
    "경영학과 심리학은 서로 다른 연구 패러다임과 방법론을 가지고 있습니다",
    "경영학 케이스 스터디는 맥락 중심의 심층 분석을, 심리학 실험은 통제된 환경에서의 인과관계 규명을 중시합니다",
    "각 분야의 연구 방법론에 대한 이해는 더 효과적인 프롬프트 작성에 도움이 됩니다",
    "동일한 현상도 분야에 따라 다른 관점과 방법으로 접근할 수 있습니다",
    "학제간 연구는 각 분야의 강점을 결합하여 더 포괄적인 이해를 제공할 수 있습니다"
]

def get_basic_prompt(topic: str) -> str:
    """기본 프롬프트 생성"""
    return f"{topic}에 대해 설명해주세요."

def get_enhanced_prompt(topic: str, purpose: str, output_format: str) -> str:
    """향상된 프롬프트 생성"""
    builder = PromptBuilder()
    
    # 분야별 역할 및 맥락 설정
    if "경영학 케이스 스터디" in topic and "비교" not in topic and "통합" not in topic:
        builder.add_role(
            "경영학 연구 방법론 전문가", 
            "유명 경영대학원의 연구 방법론 교수로, 특히 케이스 스터디 방법론에 전문성을 가지고 있으며, 하버드 비즈니스 스쿨 스타일의 케이스 개발과 분석 경험이 풍부합니다."
        )
        
        builder.add_context(
            f"저는 경영학 석사과정 학생으로 {topic}에 관한 심층적인 이해가 필요합니다. "
            f"수업에서 기업 케이스 스터디 프로젝트를 수행해야 하며, 체계적인 접근법과 방법론을 배우고 싶습니다. "
            f"단순한 기업 사례 설명이 아닌, 학술적으로 견고한 케이스 스터디 연구를 수행하는 방법에 대해 알고 싶습니다."
        )
        
        builder.add_instructions([
            "경영학에서 케이스 스터디 방법론의 학술적 기반과 이론적 배경을 설명해주세요",
            "체계적인 케이스 스터디 연구의 주요 단계와 각 단계별 핵심 활동을 상세히 설명해주세요",
            "데이터 수집(인터뷰, 문서 분석, 관찰 등)과 분석 방법을 구체적으로 안내해주세요",
            "케이스 스터디 결과의 타당성과 신뢰성을 높이는 방법을 제안해주세요",
            "실제 경영학 연구에서 사용된 우수한 케이스 스터디 예시와 해당 연구의 구조를 분석해주세요"
        ])
        
    elif "심리학 실험 설계" in topic and "비교" not in topic and "통합" not in topic:
        builder.add_role(
            "심리학 연구 방법론 전문가", 
            "심리학 연구 방법론과 실험 설계를 전문으로 하는 교수로, 다양한 실험 패러다임 개발과 연구 설계에 풍부한 경험을 가지고 있습니다."
        )
        
        builder.add_context(
            f"저는 심리학과 대학원생으로 {topic}에 관한 체계적인 이해가 필요합니다. "
            f"첫 독립 연구 프로젝트를 위한 실험을 설계 중이며, 과학적으로 견고한 실험 설계와 방법론적 엄격성을 갖춘 "
            f"연구를 수행하는 방법을 배우고 싶습니다."
        )
        
        builder.add_instructions([
            "심리학 실험 연구의 철학적/과학적 기반과 주요 연구 패러다임을 설명해주세요",
            "견고한 심리학 실험 설계의 핵심 원칙과 요소(독립/종속변수, 통제, 조작 등)를 설명해주세요",
            "다양한 실험 설계(무작위 통제, 반복 측정, 준실험 등)의 특징과 적용 상황을 비교해주세요",
            "실험에서 발생할 수 있는 주요 오류와 편향, 그리고 이를 방지하는 방법을 제안해주세요",
            "IRB 승인, 참가자 동의, 윤리적 고려사항 등 연구 윤리를 실험에 통합하는 방법을 설명해주세요",
            "실제 심리학 연구에서 사용된 우수한 실험 설계 예시와 해당 설계의 강점을 분석해주세요"
        ])
        
    elif "방법론 비교" in topic or ("경영학" in topic and "심리학" in topic):
        builder.add_role(
            "학제간 연구 방법론 전문가", 
            "경영학과 심리학 모두에서 연구 경험이 있는 학제간 연구 방법론 전문가로, 두 분야의 연구 접근법 차이와 통합 가능성에 대한 폭넓은 이해를 가지고 있습니다."
        )
        
        builder.add_context(
            f"저는 경영심리학 복수전공 대학원생으로 {topic}에 관한 체계적인 이해가 필요합니다. "
            f"두 분야의 대표적 연구 방법론의 차이점과 각각의 강점, 한계, 적용 상황에 대해 깊이 이해하고 싶습니다. "
            f"또한 실제 연구에서 두 접근법의 적절한 선택과 가능한 통합 방안에 대해서도 알고 싶습니다."
        )
        
        builder.add_instructions([
            "경영학 케이스 스터디와 심리학 실험 설계의 철학적/인식론적 기반 차이를 비교해주세요",
            "두 방법론의 주요 특징, 단계, 데이터 수집 및 분석 방법을 체계적으로 대조해주세요",
            "각 방법론의 강점과 한계, 그리고 가장 적합한 연구 질문 유형을 분석해주세요",
            "동일한 현상(예: 리더십, 의사결정, 동기부여 등)을 두 방법론으로 접근할 때의 차이점을 구체적 예시로 보여주세요",
            "두 방법론을 보완적으로 활용하여 더 포괄적인 연구를 설계하는 방법을 제안해주세요",
            "학제간 연구를 위한 방법론적 통합의 도전과제와 극복 전략을 설명해주세요"
        ])
        
    elif "현상 분석 접근법" in topic:
        builder.add_role(
            "다학제적 연구 전문가", 
            "경영학과 심리학 관점에서 조직 현상을 분석하는 다학제적 연구자로, 두 분야의 이론과 방법론을 통합하여 복잡한 현상을 다차원적으로 분석하는 전문성을 가지고 있습니다."
        )
        
        builder.add_context(
            f"저는 조직심리학 전공 연구자로 {topic}에 관심이 있습니다. "
            f"리더십, 팀 동학, 의사결정, 조직 변화 등과 같은 현상을 경영학과 심리학 두 관점에서 어떻게 다르게 접근하고 분석하는지 이해하고 싶습니다. "
            f"각 분야의 고유한 이론적 렌즈와 방법론적 접근법의 차이, 그리고 이러한 차이가 연구 결과와 실무적 함의에 어떤 영향을 미치는지 알고 싶습니다."
        )
        
        builder.add_instructions([
            "경영학과 심리학이 같은 조직 현상을 바라보는 관점과 접근 방식의 근본적 차이를 설명해주세요",
            "구체적인 조직 현상(예: 리더십, 팀워크, 변화 관리 등) 2-3가지를 선택하여 두 분야의 접근법 차이를 상세히 비교해주세요",
            "각 분야가 중점을 두는 분석 수준(개인, 집단, 조직 등)과 핵심 변수의 차이를 설명해주세요",
            "동일한 현상에 대한 연구 질문, 가설 설정, 데이터 수집 방식의 차이를 구체적 예시와 함께 보여주세요",
            "두 분야의 접근법이 도출하는 상이한 통찰과 실무적 함의를 비교해주세요",
            "두 관점을 통합하여 현상을 더 포괄적으로 이해하는 다학제적 접근법을 제안해주세요"
        ])
        
    elif "통합 연구 방법" in topic:
        builder.add_role(
            "학제간 연구 설계 전문가", 
            "경영학과 심리학의 방법론을 창의적으로 통합하여 혁신적인 연구 설계를 개발하는 전문가로, 다양한 학제간 연구 프로젝트를 성공적으로 이끈 경험이 있습니다."
        )
        
        builder.add_context(
            f"저는 조직행동 분야 박사과정 학생으로 {topic}에 관심이 있습니다. "
            f"학위 논문을 위해 경영학의 맥락적 이해와 심리학의 인과관계 검증을 결합한 통합적 연구 접근법을 개발하고 싶습니다. "
            f"두 분야의 방법론적 강점을 활용하면서도 각 접근법의 한계를 보완할 수 있는 실용적인 통합 연구 프레임워크가 필요합니다."
        )
        
        builder.add_instructions([
            "경영학 케이스 스터디와 심리학 실험 설계의 핵심 강점과 한계를 요약해주세요",
            "두 방법론을 통합한 혁신적 연구 프레임워크를 단계별로 제안해주세요",
            "통합 접근법에서 연구 질문 설정, 데이터 수집, 분석 방법을 구체적으로 설명해주세요",
            "방법론적 통합에서 발생할 수 있는 인식론적, 실용적 도전과제와 해결 전략을 제시해주세요",
            "이러한 통합 접근법이 특히 효과적일 수 있는 조직행동/경영심리학 연구 주제들을 제안해주세요",
            "실제 연구에 적용할 수 있는 구체적인 연구 설계 예시와 실행 계획을 포함해주세요"
        ])
        
    else:
        builder.add_role(
            "연구 방법론 전문가", 
            "다양한 학문 분야의 연구 방법론에 정통한 전문가로, 특히 경영학과 심리학의 연구 접근법에 대한 깊은 이해를 가지고 있습니다."
        )
        
        builder.add_context(
            f"저는 대학원생으로 {topic}에 관한 체계적인 이해가 필요합니다. "
            f"다양한 연구 방법론의 특성과 적용 방법, 그리고 각 방법론의 강점과 한계에 대해 알고 싶습니다. "
            f"특히 실제 연구 설계와 수행에 있어 방법론적 선택이 연구 결과와 해석에 미치는 영향에 대해 이해하고 싶습니다."
        )
        
        builder.add_instructions([
            f"{topic}의 이론적 기반과 학문적 맥락을 설명해주세요",
            "해당 연구 방법론의 주요 단계와 구성 요소를 체계적으로 설명해주세요",
            "방법론적 선택이 연구 결과와 해석에 미치는 영향을 분석해주세요",
            "해당 방법론의 강점과 한계, 그리고 이를 보완하기 위한 전략을 제안해주세요",
            "실제 연구 사례를 통해 방법론의 적용 방법과 고려사항을 구체적으로 설명해주세요"
        ])
    
    # 출력 형식 지정
    builder.add_format_instructions(
        f"응답은 {output_format} 형식으로 구성해주세요. "
        f"마크다운 형식을 사용하여 제목, 소제목, 목록 등을 명확히 구분해주세요. "
        f"다음 구조를 포함해주세요: "
        f"1) 이론적 배경 및 학문적 맥락 "
        f"2) 방법론의 핵심 원칙과 구성요소 "
        f"3) 단계별 실행 과정과 고려사항 "
        f"4) 데이터 수집 및 분석 방법 "
        f"5) 방법론적 강점과 한계 "
        f"6) 실제 연구 적용 사례 또는 예시 "
        f"학술적 엄격성을 유지하면서도 대학원생이 실제 연구에 적용할 수 있을 만큼 실용적인 내용으로 구성해주세요. "
        f"관련 학술 용어를 적절히 사용하되 필요에 따라 간략히 설명을 추가해주세요. "
        f"비교 표, 흐름도, 체크리스트 등 시각적 요소를 활용하여 이해를 돕습니다."
    )
    
    return builder.build()

def main():
    """메인 함수"""
    # 실행 결과를 저장할 때 챕터별 폴더 구조를 사용
    run_exercise(
        title="경영학 케이스 스터디 vs 심리학 실험 설계",
        topic_options=RESEARCH_METHODOLOGY_TOPICS,
        get_basic_prompt=get_basic_prompt,
        get_enhanced_prompt=get_enhanced_prompt,
        prompt_summary=PROMPT_SUMMARY,
        learning_points=LEARNING_POINTS
    )

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n프로그램이 사용자에 의해 중단되었습니다.")
    except Exception as err:
        print(f"\n오류 발생: {err}")
        print("API 키나 네트워크 연결을 확인하세요.")