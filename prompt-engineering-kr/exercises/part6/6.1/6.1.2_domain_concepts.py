"""
분야별 지식 구조 파악 방법 실습 모듈

Part 6 - 섹션 6.1.2 실습 코드: 다양한 학문/전문 분야의 지식 구조와 조직 방식을 이해하고, 이를 프롬프트에 효과적으로 반영하는 방법을 학습합니다.
"""

import os
import sys
from typing import Dict, List, Any, Optional

# 상위 디렉토리를 경로에 추가하여 utils 모듈을 import할 수 있게 설정
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_dir)))
sys.path.append(project_root)

from utils.prompt_builder import PromptBuilder
from utils.exercise_template import run_exercise

# 주제 옵션 정의
KNOWLEDGE_STRUCTURE_TOPICS = {
    "1": {"name": "경영학", "topic": "경영학의 지식 구조와 주요 하위 분야", "output_format": "지식 맵"},
    "2": {"name": "컴퓨터 과학", "topic": "컴퓨터 과학의 개념적 구조와 학습 경로", "output_format": "개념 프레임워크"},
    "3": {"name": "심리학", "topic": "심리학의 이론적 패러다임과 연구 영역", "output_format": "분야 구조도"},
    "4": {"name": "의학", "topic": "의학 지식의 조직 체계와 전문 분야", "output_format": "지식 체계 분석"},
    "5": {"name": "법학", "topic": "법학의 체계와 하위 법률 분야", "output_format": "분류 체계"}
}

# 프롬프트 요약 정보
PROMPT_SUMMARY = {
    "basic": ["주제에 대한 일반적인 지식 구조 요청"],
    "enhanced": [
        "구조 유형 명시: 계층적, 네트워크형, 패러다임 등 구조 유형 지정",
        "다차원 분석: 여러 관점에서 지식 구조 분석 요청",
        "시각화 요청: 개념 맵, 프레임워크 등 시각적 구조화 요청",
        "응용 가능성: 지식 구조 기반 학습/연구 방법 제안 요청"
    ]
}

# 학습 포인트
LEARNING_POINTS = [
    "각 학문/전문 분야는 고유한 지식 구조와 조직 방식을 가지고 있어 이를 이해하면 더 효과적인 학습과 소통이 가능합니다",
    "지식 구조 유형(계층적, 순차적, 네트워크형, 축적적, 패러다임)에 따라 적합한 프롬프트 접근법이 달라집니다",
    "분야의 지식 구조를 다양한 관점(개념 매핑, 교과 과정, 분류 체계, 방법론, 역사적 발전)에서 분석하면 더 깊은 이해가 가능합니다",
    "지식 구조에 대한 이해를 프롬프트에 반영하면 더 체계적이고 맥락에 맞는 응답을 얻을 수 있습니다"
]

def get_basic_prompt(topic: str) -> str:
    """기본 프롬프트 생성"""
    return f"{topic}에 대해 설명해주세요."

def get_enhanced_prompt(topic: str, purpose: str, output_format: str) -> str:
    """향상된 프롬프트 생성"""
    builder = PromptBuilder()
    
    # 분야별 역할 및 맥락 설정
    if "경영학" in purpose:
        builder.add_role(
            "경영학 교육 전문가",
            "경영대학 교수이자 커리큘럼 설계자로, 경영학의 다양한 하위 분야와 지식 체계에 대한 깊은 이해를 바탕으로 학생들에게 분야 간 연결성과 체계적 접근법을 가르치는 전문가"
        )
        
        builder.add_context(
            f"저는 경영학을 전공하는 학생으로 {topic}에 관심이 있습니다. "
            f"경영학이 매우 광범위한 분야여서 전체 지식 구조와 하위 분야들의 관계를 "
            f"명확히 이해하기 어렵습니다. 체계적인 학습과 연구를 위해 경영학의 "
            f"지식 구조와 개념적 프레임워크를 파악하고 싶습니다."
        )
        
        builder.add_instructions([
            "경영학의 주요 지식 구조를 다양한 관점(계층적, 기능적, 이론-실무 등)에서 분석해주세요",
            "핵심 하위 분야(마케팅, 재무, 인사, 전략 등)의 관계와 상호 연결성을 설명해주세요",
            "각 하위 분야의 주요 이론적 기반과 핵심 개념 프레임워크를 구조화해주세요",
            "경영학 지식의 발전 경로와 학습 순서에 대한 제안을 포함해주세요",
            "이론과 실무, 정량적 접근과 정성적 접근 등 다양한 축을 기준으로 지식 구조를 분석해주세요",
            "경영학 전공자가 전체 분야를 조망하고 특정 영역을 심화 학습하기 위한 체계적 접근법을 제안해주세요"
        ])
        
    elif "컴퓨터" in purpose or "과학" in purpose:
        builder.add_role(
            "컴퓨터 과학 교육 전문가",
            "컴퓨터 과학 교수이자 커리큘럼 설계자로, 이론적 기초부터 실용적 응용까지 컴퓨터 과학의 다양한 영역을 체계적으로 연결하여 가르치는 전문가"
        )
        
        builder.add_context(
            f"저는 컴퓨터 과학을 공부하는 학생으로 {topic}에 관심이 있습니다. "
            f"컴퓨터 과학의 다양한 하위 분야와 개념들이 어떻게 연결되고 구조화되어 있는지 "
            f"파악하기 어렵습니다. 효과적인 학습과 진로 계획을 위해 컴퓨터 과학의 "
            f"전체 지식 구조와 개념 체계를 이해하고 싶습니다."
        )
        
        builder.add_instructions([
            "컴퓨터 과학의 지식 구조를 다양한 관점(계층적, 축적적, 응용 영역별 등)에서 분석해주세요",
            "핵심 하위 분야(알고리즘, 프로그래밍 언어, 컴퓨터 구조, 운영체제, 데이터베이스, 인공지능 등)의 관계와 상호의존성을 설명해주세요",
            "이론적 기초(수학적 개념, 계산 이론 등)와 실용적 응용 영역 간의 연결 구조를 시각화해주세요",
            "컴퓨터 과학 지식의 축적적 성격과 효과적인 학습 경로를 구조화해주세요",
            "빠르게 변화하는 기술과 안정적인 기본 원리의 관계를 지식 구조 관점에서 설명해주세요",
            "컴퓨터 과학을 체계적으로 학습하기 위한 개념적 로드맵을 제시해주세요"
        ])
        
    elif "심리학" in purpose:
        builder.add_role(
            "심리학 이론 전문가",
            "심리학과 교수이자 이론 연구자로, 다양한 심리학적 패러다임과 연구 전통을 비교 분석하고 통합적 이해를 추구하는 전문가"
        )
        
        builder.add_context(
            f"저는 심리학을 전공하는 학생으로 {topic}에 관심이 있습니다. "
            f"심리학의 다양한 이론적 관점과 연구 영역이 어떻게 구조화되어 있는지 "
            f"이해하기 어렵습니다. 심리학의 전체 지식 체계와 다양한 패러다임의 "
            f"관계를 체계적으로 파악하고 싶습니다."
        )
        
        builder.add_instructions([
            "심리학의 주요 이론적 패러다임(정신분석, 행동주의, 인지심리학, 인본주의, 진화심리학 등)의 관계와 발전 구조를 분석해주세요",
            "심리학의 주요 연구 영역(임상, 발달, 사회, 인지, 생물 등)과 그 상호 연결성을 구조화해주세요",
            "심리학 지식의 조직 방식을 다양한 차원(패러다임 중심, 연구 방법론 중심, 현상 중심 등)에서 설명해주세요",
            "심리학의 역사적 발전 과정과 패러다임 전환을 지식 구조의 관점에서 분석해주세요",
            "이론과 실용, 과학과 인문학적 접근의 교차점으로서 심리학의 지식 구조를 설명해주세요",
            "심리학을 체계적으로 이해하기 위한 개념적 지도와 학습 접근법을 제안해주세요"
        ])
        
    elif "의학" in purpose:
        builder.add_role(
            "의학 교육 전문가",
            "의과대학 교수이자 교육과정 설계자로, 기초 의학과 임상 의학을 연결하고 학생들에게 의학 지식의 체계적 구조를 가르치는 전문가"
        )
        
        builder.add_context(
            f"저는 의학을 공부하는 학생으로 {topic}에 관심이 있습니다. "
            f"의학 지식의 방대한 범위와 복잡성으로 인해 전체 구조와 조직 체계를 "
            f"파악하기 어렵습니다. 효과적인 학습과 임상 적용을 위해 의학 지식의 "
            f"체계적 구조와 전문 분야 간 관계를 이해하고 싶습니다."
        )
        
        builder.add_instructions([
            "의학 지식의 주요 조직 체계를 다양한 관점(해부학적, 생리학적, 병리학적, 임상적 등)에서 분석해주세요",
            "기초 의학과 임상 의학 간의 구조적 연결과 지식 흐름을 설명해주세요",
            "주요 의학 전문 분야와 세부 전공의 분류 체계 및 상호 관계를 구조화해주세요",
            "의학 지식의 축적 및 발전 방식과 근거 기반 의학의 방법론적 구조를 설명해주세요",
            "장기 시스템, 질병 메커니즘, 진단-치료 프로세스 등 다양한 프레임워크의 상호 보완성을 분석해주세요",
            "의학을 체계적으로 학습하고 통합적으로 적용하기 위한 개념적 접근법을 제안해주세요"
        ])
        
    elif "법학" in purpose:
        builder.add_role(
            "법학 교육 전문가",
            "법과대학 교수이자 법학 교육 프로그램 설계자로, 법체계의 구조와 다양한 법률 분야의 상호관계를 체계적으로 가르치는 전문가"
        )
        
        builder.add_context(
            f"저는 법학을 공부하는 학생으로 {topic}에 관심이 있습니다. "
            f"법학의 광범위한 분야와 복잡한 법체계를 전체적으로 파악하기 어렵습니다. "
            f"효과적인 학습과 법률 실무 준비를 위해 법학 지식의 구조와 다양한 "
            f"법률 분야의 관계를 체계적으로 이해하고 싶습니다."
        )
        
        builder.add_instructions([
            "법학의 지식 체계를 다양한 분류 방식(공법/사법, 실체법/절차법, 국내법/국제법 등)에 따라 구조화해주세요",
            "주요 법률 분야(헌법, 민법, 형법, 상법, 행정법 등)의 상호 관계와 위계 구조를 설명해주세요",
            "법원(法源)의 체계와 법적 추론의 구조를 분석해주세요",
            "법학 지식의 역사적 발전과 법체계의 진화 과정을 구조적 관점에서 설명해주세요",
            "이론법학과 실무법학의 관계, 그리고 다양한 법학 방법론의 구조적 특성을 분석해주세요",
            "법학을 체계적으로 학습하고 법적 사고를 발전시키기 위한 개념적 접근법을 제안해주세요"
        ])
        
    else:
        builder.add_role(
            f"{purpose} 교육 전문가", 
            f"{topic}에 관한 체계적인 이해와 교육 방법론을 연구하는 전문가"
        )
        
        builder.add_context(
            f"저는 {purpose}을/를 공부하는 학생으로 {topic}에 관심이 있습니다. "
            f"이 분야의 지식 구조와 개념 체계를 명확히 이해하고 싶습니다. "
            f"효과적인 학습과 연구를 위해 분야의 전체적인 지도와 체계적인 접근법이 필요합니다."
        )
        
        builder.add_instructions([
            f"{topic}의 지식 구조를 다양한 관점에서 분석해주세요",
            "주요 하위 분야와 전문 영역의 관계 및 상호 연결성을 설명해주세요",
            "핵심 개념과 이론적 프레임워크의 구조적 관계를 시각화해주세요",
            "이 분야 지식의 조직 및 발전 방식의 특징을 분석해주세요",
            "다양한 관점과 접근법의 구조적 관계를 설명해주세요",
            "이 분야를 체계적으로 학습하고 연구하기 위한 개념적 로드맵을 제안해주세요"
        ])
    
    # 출력 형식 지정
    builder.add_format_instructions(
        f"응답은 {output_format} 형식으로 구성해주세요. "
        f"마크다운 형식을 사용하여 제목, 소제목, 목록 등을 명확히 구분해주세요. "
        f"다음 구조로 지식 체계를 체계적으로 분석해주세요:\n\n"
        f"1. 개요: 해당 분야의 지식 구조 특성에 대한 종합적 분석\n"
        f"2. 다차원 구조 분석: 다양한 관점에서 분석한 지식 구조(계층적, 네트워크형, 패러다임 등)\n"
        f"3. 주요 하위 분야 매핑: 핵심 영역과 그 관계성 시각화\n"
        f"4. 지식 발전 경로: 기초에서 고급으로의 지식 축적 구조\n"
        f"5. 방법론적 구조: 연구/실무 방법의 체계화\n"
        f"6. 학습 및 적용 프레임워크: 지식 구조 기반의 효과적 학습 및 응용 방법\n\n"
        f"복잡한 관계와 구조를 시각적으로 표현하기 위해 다이어그램, 마인드맵, 계층도 등의 형식을 활용해주세요. "
        f"텍스트 기반 시각화가 가능한 형태(마크다운 테이블, 들여쓰기 목록 등)로 구현해주세요."
    )
    
    return builder.build()

def main():
    """메인 함수"""
    # 실행 결과를 저장할 때 챕터별 폴더 구조를 사용
    run_exercise(
        title="분야별 지식 구조 파악 방법",
        topic_options=KNOWLEDGE_STRUCTURE_TOPICS,
        get_basic_prompt=get_basic_prompt,
        get_enhanced_prompt=get_enhanced_prompt,
        prompt_summary=PROMPT_SUMMARY,
        learning_points=LEARNING_POINTS
    )

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n프로그램이 사용자에 의해 중단되었습니다.")
    except Exception as err:
        print(f"\n오류 발생: {err}")
        print("API 키나 네트워크 연결을 확인하세요.")