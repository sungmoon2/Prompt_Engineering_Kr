"""
해당 분야의 사고방식 채택하기 실습 모듈

Part 6 - 섹션 6.3.1 실습 코드: 다양한 학문 분야의 사고방식을 이해하고 실제 문제에
적용하는 방법을 학습합니다.
"""

import os
import sys
from typing import Dict, List, Any, Optional

# 상위 디렉토리를 경로에 추가하여 utils 모듈을 import할 수 있게 설정
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_dir)))
sys.path.append(project_root)

from utils.prompt_builder import PromptBuilder
from utils.exercise_template import run_exercise

# 주제 옵션 정의
DOMAIN_THINKING_TOPICS = {
    "1": {"name": "과학적 사고", "topic": "과학자의 사고방식으로 문제 분석", "output_format": "과학적 분석"},
    "2": {"name": "공학적 사고", "topic": "엔지니어의 사고방식으로 문제 접근", "output_format": "설계 분석"},
    "3": {"name": "의학적 사고", "topic": "의학 전문가의 진단적 사고 적용", "output_format": "임상 분석"},
    "4": {"name": "경영학적 사고", "topic": "경영 전문가의 전략적 사고 활용", "output_format": "비즈니스 분석"},
    "5": {"name": "법률적 사고", "topic": "법률 전문가의 논리적 추론 적용", "output_format": "법적 분석"}
}

# 프롬프트 요약 정보
PROMPT_SUMMARY = {
    "basic": ["특정 관점의 일반적 분석 요청"],
    "enhanced": [
        "구체적 분야 전문가 역할 설정",
        "분야별 사고 프로세스 명시",
        "특화 프레임워크/도구 활용 요청",
        "다층적/구조적 분석 요구"
    ]
}

# 학습 포인트
LEARNING_POINTS = [
    "각 학문 분야는 고유한 사고방식, 분석 도구, 접근법을 가지고 있습니다",
    "특정 분야의 사고방식을 채택하면 문제를 더 체계적이고 깊이 있게 분석할 수 있습니다",
    "구체적인 전문성과 분야별 프레임워크를 명시하는 프롬프트가 더 전문적인 분석을 이끌어냅니다",
    "분야별 사고 프로세스를 단계적으로 요청하면 더 구조화된 분석 결과를 얻을 수 있습니다",
    "다양한 분야의 사고방식을 통합하면 복잡한 문제에 대한 더 균형 잡힌 이해가 가능합니다"
]

def get_basic_prompt(topic: str) -> str:
    """기본 프롬프트 생성"""
    if "과학적" in topic:
        return "이 현상을 과학적 관점에서 분석해주세요."
    elif "공학적" in topic:
        return "이 문제를 공학적 관점에서 해결해주세요."
    elif "의학적" in topic:
        return "이 증상을 의학적 관점에서 진단해주세요."
    elif "경영학적" in topic:
        return "이 비즈니스 상황을 경영학적 관점에서 분석해주세요."
    elif "법률적" in topic:
        return "이 사례를 법률적 관점에서 검토해주세요."
    else:
        return f"{topic}에 관해 분석해주세요."

def get_enhanced_prompt(topic: str, purpose: str, output_format: str) -> str:
    """향상된 프롬프트 생성"""
    builder = PromptBuilder()
    
    # 분야별 역할 및 맥락 설정
    if "과학적" in topic:
        builder.add_role(
            "실험 물리학자", 
            "양자역학 분야에서 15년간 연구한 이론 및 실험 물리학자로, 과학적 방법론과 실증적 검증을 통해 자연 현상을 체계적으로 분석하는 전문가입니다. 특히 복잡한 현상을 검증 가능한 가설로 변환하고 엄격한 실험 설계를 통해 검증하는 데 전문성이 있습니다."
        )
        
        builder.add_context(
            "물체가 떨어지는 속도가 물체의 무게에 따라 달라지는지에 대한 오래된 믿음을 과학적으로 분석하고자 합니다. "
            "많은 사람들이 무거운 물체가 가벼운 물체보다 더 빨리 떨어진다고 믿지만, 이것이 과학적으로 정확한지 "
            "체계적인 과학적 사고와 실험적 접근법을 통해 분석해주세요."
        )
        
        builder.add_instructions([
            "과학적 방법론에 따라 명확한 가설을 설정해주세요",
            "이 현상을 설명하는 물리 법칙과 원리를 명확히 제시해주세요",
            "가설을 검증하기 위한 체계적인 실험 설계 방법을 제안해주세요",
            "예상되는 실험 결과와 그 해석 방법을 설명해주세요",
            "이 문제에 대한 역사적 과학적 관점의 변화와 갈릴레오, 뉴턴 등의 기여를 포함해주세요",
            "일상적 관찰과 과학적 검증의 차이점을 설명하고, 일반적인 오해의 원인을 분석해주세요"
        ])
        
    elif "공학적" in topic:
        builder.add_role(
            "시스템 엔지니어", 
            "항공우주 및 로봇 시스템 설계에 20년 경력을 가진 시스템 엔지니어로, 복잡한 기술적 문제를 분해하고 체계적으로 해결하는 전문가입니다. 특히 트레이드오프 분석, 최적화, 실패 모드 분석 등 공학적 사고 도구를 활용한 설계와 문제 해결에 전문성이 있습니다."
        )
        
        builder.add_context(
            "도시 내 교통 혼잡 문제를 해결하기 위한 지능형 교통 시스템을 설계하려고 합니다. "
            "출퇴근 시간 교통 체증이 심각하며, 긴급 차량의 통행이 지연되고, 대중교통의 정시성이 떨어지는 상황입니다. "
            "이 문제를 공학적 사고방식으로 접근하여 체계적인 해결책을 도출해주세요."
        )
        
        builder.add_instructions([
            "공학적 문제 정의 방법론을 사용하여 문제를 명확히 정의하고 범위를 설정해주세요",
            "시스템 요구사항 분석과 기능적/비기능적 요구사항을 체계적으로 도출해주세요",
            "설계 대안을 생성하고 트레이드오프 분석을 통해 평가하는 과정을 보여주세요",
            "선택한 솔루션의 구체적 설계 방향과 핵심 구성요소를 제시해주세요",
            "설계에 대한 검증 및 테스트 방법론을 설명해주세요",
            "잠재적 실패 모드와 리스크 분석을 포함한 엔지니어링 사고 과정을 보여주세요"
        ])
        
    elif "의학적" in topic:
        builder.add_role(
            "내과 전문의", 
            "종합병원에서 10년간 내과 전문의로 근무하며 복잡한 증상을 체계적으로 진단하는 전문가입니다. 특히 증거 기반 의학, 임상적 추론, 감별 진단 과정에서 전문성을 가지고 있으며, 증상의 패턴을 인식하고 체계적으로 분석하는 능력이 뛰어납니다."
        )
        
        builder.add_context(
            "45세 남성 환자가 3주간 지속된 피로감, 체중 감소, 밤에 심해지는 발열, 그리고 지속적인 기침을 호소하며 "
            "내원했습니다. 최근 해외 여행 이력이 있으며, 이전에는 건강했다고 합니다. 이 환자의 증상을 의학적 "
            "진단 사고 프로세스를 사용하여 체계적으로 분석해주세요."
        )
        
        builder.add_instructions([
            "의학적 병력 청취 및 데이터 수집 과정을 체계적으로 설명해주세요",
            "주요 증상과 징후를 분류하고 패턴을 분석해주세요",
            "감별 진단 목록을 작성하고 각 가능성의 근거를 제시해주세요",
            "추가적인 검사와 그 논리적 근거를 우선순위에 따라 제안해주세요",
            "각 진단 가설의 검증 과정과 치료적 접근법을 설명해주세요",
            "불확실성 관리와 경과 관찰 계획을 포함한 임상적 의사결정 과정을 보여주세요"
        ])
        
    elif "경영학적" in topic:
        builder.add_role(
            "전략 컨설턴트", 
            "글로벌 경영 컨설팅 회사에서 15년간 다양한 산업의 기업 전략을 자문한 시니어 컨설턴트로, 비즈니스 문제를 체계적으로 분석하고 전략적 해결책을 도출하는 전문가입니다. 특히 경쟁 분석, 시장 기회 평가, 비즈니스 모델 혁신 분야에서 풍부한 경험을 갖고 있습니다."
        )
        
        builder.add_context(
            "전통적인 소매업체가 디지털 전환을 통해 온라인 경쟁자들에 대응하고자 합니다. 최근 5년간 "
            "실적이 지속적으로 하락하고 있으며, 젊은 소비자층의 유입이 감소하고 있습니다. 이 기업의 "
            "상황을 경영 전략적 사고방식으로 분석하고 전략적 방향을 제시해주세요."
        )
        
        builder.add_instructions([
            "경영 컨설팅의 구조화된 문제 접근법을 사용하여 상황을 분석해주세요",
            "외부 환경 분석(PESTEL)과 산업 분석(포터의 5가지 경쟁 요인)을 실시해주세요",
            "기업의 내부 역량과 경쟁 우위 요소를 VRIO 프레임워크로 평가해주세요",
            "핵심 전략적 대안을 도출하고 각 옵션의 장단점을 분석해주세요",
            "권장 전략과 구체적인 실행 로드맵을 제시해주세요",
            "성공적인 전략 실행을 위한 핵심 성공 요인과 잠재적 위험 요소를 식별해주세요"
        ])
        
    elif "법률적" in topic:
        builder.add_role(
            "상법 전문 변호사", 
            "15년 경력의 상법 전문 변호사로, 특히 계약법, 기업법, 지적재산권 분쟁에 전문성을 가지고 있습니다. 법적 사례를 체계적으로 분석하고, 선례와 법리를 적용하여 논리적 추론을 전개하는 능력이 뛰어납니다. 다수의 복잡한 기업 간 분쟁을 성공적으로 해결한 경험이 있습니다."
        )
        
        builder.add_context(
            "기술 스타트업 A사가 대기업 B사와 소프트웨어 라이센싱 계약을 체결했습니다. 1년 후, B사가 계약 범위를 "
            "벗어나 A사의 기술을 활용한 새로운 제품을 출시했으며, A사는 이에 대한 법적 대응을 고려하고 있습니다. "
            "이 사례를 법률 전문가의 사고방식으로 분석해주세요."
        )
        
        builder.add_instructions([
            "법률적 이슈 식별(IRAC 방법론의 Issue 단계)을 수행하여 핵심 법적 쟁점을 명확히 해주세요",
            "관련 법률, 원칙, 판례를 식별하고 적용 가능성을 분석해주세요(Rule 단계)",
            "사실 관계를 법적 원칙에 적용하여 논리적 추론을 전개해주세요(Application 단계)",
            "각 쟁점에 대한 법적 결론과 가능한 법적 주장을 제시해주세요(Conclusion 단계)",
            "원고와 피고 양측의 잠재적 법적 논증을 비교 분석해주세요",
            "소송 전략과 대안적 분쟁 해결 방안을 법적 위험과 비용 측면에서 평가해주세요"
        ])
        
    else:
        builder.add_role(
            f"{purpose} 전문가", 
            f"{topic}에 깊은 전문성을 가진 전문가로, 해당 분야의 구조화된 사고방식과 체계적인 분석 도구를 활용하여 문제에 접근합니다."
        )
        
        builder.add_context(
            f"{topic}과 관련된 문제 상황을 분석하고자 합니다. 이 분야의 전문가라면 "
            f"어떤 사고방식과 접근법으로 이 문제를 분석할지 체계적으로 보여주세요."
        )
        
        builder.add_instructions([
            f"{topic}과 관련된 전문 분야의 주요 개념과 원리를 적용해주세요",
            "해당 분야의 표준적인 분석 프레임워크와 도구를 활용해주세요",
            "문제 접근법과 분석 과정을 단계별로 명확히 보여주세요",
            "분야별 특화된 추론 과정과 의사결정 방식을 적용해주세요",
            "해당 분야의 전문가 관점에서 주요 고려사항과 우선순위를 설명해주세요",
            "실무적 경험과 전문적 지식을 바탕으로 한 통찰과 제안을 제공해주세요"
        ])
    
    # 출력 형식 지정
    builder.add_format_instructions(
        f"응답은 {output_format} 형식으로 구성해주세요. "
        f"마크다운 형식을 사용하여 제목, 소제목, 목록 등을 명확히 구분해주세요. "
        f"해당 분야의 전문가가 실제로 사용하는 구조화된 접근법을 따라 체계적으로 정리해주세요. "
        f"전문 용어를 적절히 사용하되 필요시 간략한 설명을 포함하여 이해를 돕고, "
        f"표, 다이어그램, 프레임워크 등 해당 분야에서 활용되는 시각적 도구를 활용해주세요. "
        f"사고 과정을 단계별로 명확히 보여주고, 결론에 이르는 과정의 논리적 흐름을 강조해주세요."
    )
    
    return builder.build()

def main():
    """메인 함수"""
    # 실행 결과를 저장할 때 챕터별 폴더 구조를 사용
    run_exercise(
        title="해당 분야의 사고방식 채택하기",
        topic_options=DOMAIN_THINKING_TOPICS,
        get_basic_prompt=get_basic_prompt,
        get_enhanced_prompt=get_enhanced_prompt,
        prompt_summary=PROMPT_SUMMARY,
        learning_points=LEARNING_POINTS
    )

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n프로그램이 사용자에 의해 중단되었습니다.")
    except Exception as err:
        print(f"\n오류 발생: {err}")
        print("API 키나 네트워크 연결을 확인하세요.")